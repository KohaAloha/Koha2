<!-- TMPL_INCLUDE NAME="doc-head-open.inc" -->
<title>Koha &rsaquo; Circulation</title>
<!-- TMPL_INCLUDE NAME="doc-head-close.inc" -->
<!-- TMPL_INCLUDE NAME="menus.inc" -->
<!-- TMPL_INCLUDE NAME="menu-circ.inc" -->

<script language="JavaScript">
function check() {
	var msg = "";
	var count_reserv = 0;
	var alreadyreserved = 0;

// check if we have checkitem form
if (document.form.checkitem){
	for (i=0;i<document.form.checkitem.length;i++){
		if (document.form.checkitem[i].checked == true) {
				count_reserv++ ;
			}
	}
	// for only one item, check the checkitem without consider the loop checkitem
	if (i==0){
		if (document.form.checkitem.checked == true) {
			count_reserv++;
		}
	}
}

if (document.form.request.checked == true){
		count_reserv++ ;
}

if (document.form.alreadyreserved.value == "1"){
		 alreadyreserved++ ;
}

if (count_reserv == "0"){
		msg += ("- Please select an item to place a hold\n");
}
if (count_reserv >= "2"){
		msg += ("- You can select only one type of document\n by item, or by the first item returned\n");
}

if (alreadyreserved > "0"){
		msg += ("- This patron had already placed a hold on this item\n Please cancel the previous hold first \n");
}

	if (msg == "") return(true);
	else	{
		alert(msg);
		return(false);
	}
}
</script>
<!-- TMPL_IF NAME="messagetransfert" -->
		<div>
				<h2>Réservation trouvée pour (<!-- TMPL_VAR NAME="nextreservtitle" -->), merci de transférer</h2>
			<p>Ce document est réservé par : <b> <!-- TMPL_VAR NAME="nextreservsurname" --> <!-- TMPL_VAR NAME="nextreservfirstname" --></b>au site de <b> <!-- TMPL_VAR NAME="branchname" --> </b>; Prière de mettre ce document en transfert.
			</p>
			<form name="cancelReservewithtransfert" action="branchreserves.pl" method="post">
				<input type="submit" class="button circulation">
			</form>
		</div>
	<!-- /TMPL_IF -->
<h1>Réservations</h1>

  <h2>Informations notice</h2>
    <p><label>Civilité :  </label><a href="/cgi-bin/koha/catalogue/detail.pl?biblionumber=<!-- TMPL_VAR NAME="biblionumber" -->"><!-- TMPL_VAR NAME="title" --></a></p>
    <p><label>Auteur :  </label><!-- TMPL_VAR NAME="author" --></p>

<h2>Ajouter réservation</h2>
<!-- TMPL_UNLESS NAME="cardnumber"-->
    <form action="request.pl?biblionumber=<!-- TMPL_VAR NAME="biblionumber" -->" method="post" onSubmit="request.pl" name="getborrower">
        <!-- TMPL_UNLESS name="CGIselectborrower" -->
                <p>
                <label>Adhérent</label>
                <input type="text" size="20" name="findborrower"> (Entrer le n° de carte d'adhérent ou une partie du nom)
                </p>
                <input type="hidden" name="biblionumber" value="<!-- TMPL_VAR NAME="biblionumber"-->">
                <input type="submit" value="Rechercher">
        <!-- TMPL_ELSE -->
            <!-- TMPL_VAR NAME="CGIselectborrower" -->
                <input type="hidden" name="biblionumber" value="<!-- TMPL_VAR NAME="biblionumber"-->">
                <input type="submit" value="Sélectionner">
        <!-- /TMPL_UNLESS -->
    </form>
<!-- TMPL_ELSE -->
  <!-- TMPL_IF NAME="maxreserves" -->
    <p class="problem">
      <label><u>Trop de réservations</u></label>
      Actuellement, cet adhérent a trop réservation(s).
    </p>
    <!-- /TMPL_IF -->

    <!-- TMPL_IF NAME="expiry" -->
    <br>
    <p class="problem">
      <label>Carte expirée</label>
      La carte d'adhérent a expiré
    </p>
    <!-- /TMPL_IF -->

    <!-- TMPL_IF NAME="diffbranch" -->			
    <p class="problem">
      <label>Localisation</label>
      L'adhérent n'est pas dans son site d'inscription
    </p>
    <!-- /TMPL_IF -->

    <!-- TMPL_IF NAME="alreadyreserved" -->			
    <p class="problem">
      <label>L'opération peut être effectuée</label>
      Un adhérent a déjà une réservation sur ce document
    </p>
    <!-- /TMPL_IF -->

  <!-- TMPL_IF NAME="messageborrower" -->
    <div class="problem">No patron with this name, Please, try an other </div>
  <!-- /TMPL_IF -->
    <h3>Propriétés réservation</h3>
        <form action="placerequest.pl" method="post" onSubmit="return check();" name="form">
    
        <input type="hidden" size="10" name="member" value="<!--  TMPL_VAR NAME="cardnumber" -->">
        <input type="hidden" name="biblionumber" value="<!-- TMPL_VAR NAME="biblionumber" -->">
        <input type="hidden" name="type" value="str8">
        <input type="hidden" name="title" value="<!-- TMPL_VAR NAME="title" -->">
        <input type="hidden" name="rank-request" value="<!-- TMPL_VAR NAME="fixedRank" -->">
        <p><label>Adhérent</label>
            <!-- TMPL_IF NAME="cardnumber"-->
                <!-- TMPL_VAR NAME="borrowersurname" --> <!-- TMPL_VAR NAME="borrowerfirstname" --> (Numéro de carte : <!--  TMPL_VAR NAME="cardnumber" -->)
            <!-- TMPL_ELSE -->
                Pas encore défini
            <!-- /TMPL_IF -->
        </p>
        <p>
        <label for="priority">Priorité</label>
            <b> <!-- TMPL_VAR Name="fixedRank" --> </b>
        </p>
        <p>
            <label>Notes</label>
            <textarea name="notes" cols="20" rows="2"></textarea>
        </p>
        <p>
            <label>Récupérer à</label>
            <!-- TMPL_VAR NAME="CGIbranch" -->
        </p>
        <!-- TMPL_LOOP name="bibitemloop" -->    
        <p><label>Type de document : </label> <!-- TMPL_VAR NAME="description" --></p>
        <p><label>Année de publication :</label> <!-- TMPL_VAR NAME="publicationyear" --></p>
    
        <table>
        <tr>
            <th>Code à barres</th>
            <th>Site d'origine</th>
            <th>Site de localisation</th>
            <th>Cote</th>
            <th>Information</th>
            <th>Annuler une réservation</th>
        </tr>
    <!-- TMPL_LOOP Name="itemloop" -->
        <tr class="<!-- TMPL_VAR NAME="backgroundcolor" -->">
            <td>
                    <!-- TMPL_VAR NAME="barcode" --> 
            </td>
            <td>
            <!-- TMPL_VAR NAME="homebranch" -->
            </td>
            <td>
            <!-- TMPL_VAR NAME="holdingbranch" -->
            </td>
            <td>
            <!-- TMPL_VAR NAME="itemcallnumber" -->
            </td>
            <td>
        <!-- TMPL_IF Name="date_due" -->
            En prêt, retour attendu le <!-- TMPL_VAR NAME="date_due" -->
        <!-- /TMPL_IF -->
    
        <!-- TMPL_IF NAME="available" -->
            <label>
                <input type="checkbox" name="checkitem" value="<!-- TMPL_VAR NAME="itemnumber" -->">
                Réserver cet exemplaire
            </label>
        <!-- /TMPL_IF -->
            
        <!-- TMPL_IF name="reservedate" -->
            Documents réservés au <!-- TMPL_VAR NAME="reservedate" -->
        <!-- /TMPL_IF -->
    
        <!-- TMPL_IF Name="message" -->
            Ne peut être choisi (perdu ou en retard depuis très longtemps)
        <!-- /TMPL_IF -->
    
        <!-- TMPL_IF Name="notforloan" -->
            Ce document est exclu du prêt (<!-- TMPL_VAR NAME="notforloanvalue" -->)
        <!-- /TMPL_IF -->
    
        <!-- TMPL_IF Name="transfertwhen" -->
            Document en transfert de la bibliothèque de : <!-- TMPL_VAR NAME="transfertfrom" -->, à : <!-- TMPL_VAR NAME="transfertto" -->, le : <!-- TMPL_VAR NAME="transfertwhen" -->
        <!-- /TMPL_IF -->
            </td>
            <td>
            <!-- TMPL_IF NAME="reservedate"-->
                    <!-- TMPL_IF NAME="nocancel" -->
                            Ne peut  pas être annulé, lorsqu'il y a un exemplaire en transfert
                            <!-- TMPL_ELSE -->
                            <a class="info" href="modrequest.pl?CancelBiblioNumber=<!-- TMPL_VAR NAME="biblionumber" -->&CancelBorrowerNumber=<!-- TMPL_VAR NAME="ReservedForBorrowernumber" -->&CancelItemnumber=<!--  TMPL_VAR NAME="itemnumber"-->"  onclick="if (window.confirm('You will delete a reserve, are you sure ?'))    
                                    {return true;}
                    else {return false;}">Annuler une réservation
                    <span> Documents réservés pour : <!-- TMPL_VAR NAME="ReservedForSurname" --> <!-- TMPL_VAR NAME="ReservedForFirstname" -->
                    <br>
                    Attendu à : <!-- TMPL_VAR NAME="ExpectedAtLibrary" -->
                    </span>
                    </a>
                    <!-- /TMPL_IF -->
            <!-- TMPL_ELSE -->
                    Pas de réservation
            <!-- /TMPL_IF -->
            </td>
        </tr>
    <!-- /TMPL_LOOP --> <!-- itemloop -->
        </table>
    <!-- /TMPL_LOOP --> <!-- bibitemloop -->
    
        <p> <label>&nbsp;</label>
            S'il n'y a pas d'exemplaire disponible, réserver l'exemplaire qui reviendra le premier
            <input type="checkbox" name="request" value="Tous">
        </p>
        
        <input type="hidden" name="biblioitem" value="<!-- TMPL_VAR NAME="biblioitemnumber" -->">
        <input type="hidden" name="alreadyreserved" value="<!-- TMPL_VAR NAME="alreadyreserved" -->">
    
    <div id="actions">
    <!-- TMPL_IF NAME="cardnumber"-->
        <input type="submit" value="Réservation">
    <!-- /TMPL_IF -->
    </div>
    </form>
<!-- /TMPL_UNLESS -->
<!-- TMPL_IF name="reserveloop" -->
<h2>Réservations en attente</h2>
<form name="T<!-- TMPL_VAR NAME="time" -->" action="modrequest.pl" method="post">
    <table>
      <tr>
        <th>Priorité</th>
        <th>Adhérent</th>
        <th>Notes</th>
        <th>Date</th>
        <th>Lieu de récupération</th>
        <th>Informations</th>
      </tr>
  <!-- TMPL_LOOP Name="reserveloop" -->
      <tr>
        <td>
          <input type="hidden" name="borrowernumber" value="<!-- TMPL_VAR NAME="borrowernumber" -->">
          <input type="hidden" name="biblionumber" value="<!-- TMPL_VAR NAME="biblionumber" -->">
          <select name="rank-request">
    <!-- TMPL_IF Name="wait" -->
            <option value="W" selected>En attente</option>
    	<!-- TMPL_ELSE -->
            <option value="<!-- TMPL_VAR NAME="priority" -->" <!-- TMPL_IF Name="selected" --> selected <!-- /TMPL_IF -->>
              <!-- TMPL_VAR NAME="priority" -->
            </option>
        <!-- /TMPL_IF -->
            <option value="del">sup</option>
          </select>
        </td>
        <td>
          <a href="/cgi-bin/koha/members/moremember.pl?borrowernumber=<!-- TMPL_VAR NAME="borrowernumber" -->" ><!-- TMPL_VAR NAME="surname" -->, <!-- TMPL_VAR NAME="firstname" --></a>
        </td>
        <td><!-- TMPL_VAR NAME="notes" --></td>
        <td><!-- TMPL_VAR NAME="date" --></td>
        <td>
    <!-- TMPL_IF Name="wait" -->
    	<!-- TMPL_IF NAME="atdestination" -->
          Document en attente à <b> <!-- TMPL_VAR NAME="wbrname" --></b> <input type="hidden" name="pickup" value=<!-- TMPL_VAR NAME="wbrcd" -->>
          <!-- TMPL_ELSE -->
          Document qui sera transféré  à <b> <!-- TMPL_VAR NAME="wbrname" --></b> <input type="hidden" name="pickup" value=<!-- TMPL_VAR NAME="wbrcd" -->>
         <!-- /TMPL_IF -->
    <!-- TMPL_ELSE -->
          <select name="pickup">
      <!-- TMPL_LOOP Name="branchloop" -->
        <!-- TMPL_IF Name="selected" -->
            <option value="<!-- TMPL_VAR NAME="branch" -->" selected="selected">
        <!-- TMPL_ELSE -->
            <option value="<!-- TMPL_VAR NAME="branch" -->">
        <!-- /TMPL_IF -->
              <!-- TMPL_VAR NAME="branchname" -->
            </option>
      <!-- /TMPL_LOOP -->
          </select>
    <!-- /TMPL_IF -->
        </td>
        <td>
    <!-- TMPL_IF Name="wait" -->
          <a href="/cgi-bin/koha/catalogue/detail.pl?biblionumber=<!-- TMPL_VAR NAME='biblionumber' -->&type='intra'" onclick="openWindow(this, 'Item', 480, 640); return false;">
                <!-- TMPL_IF NAME="barcodenumber" -->
                    <!-- TMPL_VAR NAME="barcodenumber" -->
                    <input type="hidden" name="itemnumber" value=<!-- TMPL_VAR NAME="itemnumber" -->>
                <!-- TMPL_ELSE -->
                    Pas de code à barres
                <!-- /TMPL_IF -->
          </a>
    <!-- TMPL_ELSE -->
      <!-- TMPL_IF Name="constrainttypea" -->
          <i>Prochain disponible</i>
      <!-- TMPL_ELSE -->
        <!-- TMPL_IF Name="constrainttypeo" -->
          uniquement ce type : <b><!-- TMPL_VAR NAME="volumeddesc" --> <!-- TMPL_VAR NAME="itemtype" --></b>
        <!-- /TMPL_IF -->
      <!-- /TMPL_IF -->
    <!-- /TMPL_IF -->
        </td>
      </tr>
  <!-- /TMPL_LOOP --> <!-- existing reserveloop -->
      <tr>
        <td colspan="6">
          <input type="submit" name="submit" value="Annuler réservation(s)" border="0">
        </td>
      </tr>
    </table>
</form>
<!-- /TMPL_IF -->

<!-- TMPL_INCLUDE name="intranet-bottom.inc" -->
