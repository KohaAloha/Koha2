<!-- TMPL_INCLUDE NAME="doc-head-open.inc" -->
<title>Koha &rsaquo; Outils &rsaquo; Nettoyer le fichier adhérents</title>
<!-- TMPL_INCLUDE NAME="doc-head-close.inc" -->

<!-- Additions to enable Calendar system -->
<link rel="stylesheet" type="text/css" href="<!-- TMPL_VAR name="themelang" -->/includes/calendar/calendar-system.css">
<!-- End of additions --><!-- Additions to enable Calendar system -->
<script type="text/javascript" src="<!-- TMPL_VAR name="themelang" -->/includes/calendar/calendar.js"></script>
<script type="text/javascript" src="<!-- TMPL_VAR name="themelang" -->/includes/calendar/calendar-en.js"></script>
<script type="text/javascript" src="<!-- TMPL_VAR name="themelang" -->/includes/calendar/calendar-setup.js"></script>
<!-- End of additions -->

<!-- TMPL_INCLUDE NAME="menus.inc" -->
<!-- TMPL_INCLUDE NAME="menu-tools.inc" -->

<h1>Suppression de certains adhérents anciens/Anonimisation de certains historiques de prêt</h1>

<!-- TMPL_IF NAME="step1" -->
<!-- step 1 START -->
<div id="step1">
    <form name="f1" onsubmit="return checkForm(this);" action="/cgi-bin/koha/tools/cleanborrowers.pl" method="POST">
    <fieldset>
    <legend>Qu'est-ce que vous voulez faire ?</legend>
        <input id="checkborrower" type="checkbox" name="checkbox" value="adhérent" checked="true">
        <label for="checkborrower">Supprimer un adhérent qui n'a pas emprunté depuis : </label>
        <input size="10" id="date1" name="filterdate1" value="<!-- TMPL_VAR NAME="filterdate1"-->" type="text" />
            <script type="text/javascript">
                Calendar.setup(
                 {
                     inputField : "date1",
                     ifFormat : "%Y-%m-%d",
                 }
                );
            </script>
        
        <br />
        <input id="checkissue" type="checkbox" name="checkbox" value="prêt" checked="true">
        <label for="checkissue">Rendre anonyme l'historique de prêt antérieur à</label>
        <input size="10" id="date2" name="filterdate2" value="<!-- TMPL_VAR NAME="filterdate2"-->" type="text" />
            <script type="text/javascript">
                Calendar.setup(
                 {
                     inputField : "date2",
                     ifFormat : "%Y-%m-%d",
                 }
                );
            </script>
            
            <br />
            <input type="submit" value=" OK " style="float:right;" />
            
            <!-- hidden here -->
            <input type="hidden" name="step2" value="1" />
    </form>
</div>
<!-- step 1 END -->
<!-- /TMPL_IF -->

<!-- TMPL_IF NAME="step2" -->
<!-- STEP 2 START -->
<div id="step2">
    <fieldset>
        <legend>Rappels</legend>
        <b>
        <!-- TMPL_IF NAME="totalToDelete" --><!-- TMPL_VAR NAME="totalToDelete" --> <!-- TMPL_ELSE -->0 <!-- /TMPL_IF --> adhérents seront supprimés.
        <br />
        <!-- TMPL_IF NAME="totalToAnonymize" --><!-- TMPL_VAR NAME="totalToAnonymize" --> <!-- TMPL_ELSE -->0 <!-- /TMPL_IF --> l'historique de prêt sera rendu anonyme.
        <br />
        </b>
        <br />
        <form name="f2" action="/cgi-bin/koha/tools/cleanborrowers.pl" method="POST" onsubmit="return checkForm2(this);">
            <!-- TMPL_IF NAME="totalToDelete" -->
                Que voulez-vous faire des adhérents supprimés ?<br />
                <label for="delete">Supprimer complètement ces adhérents</label>
                <input id="delete" type="radio" name="radio" value="delete" checked="true" />
                
                <label for="trash">Supprimer ces adhérents</label>
                <input id="trash" type="radio" name="radio" value="trash" />
                <input type="hidden" name="do_delete" value="<!-- TMPL_VAR NAME="totalToDelete" -->" />
                <br />
            <!-- /TMPL_IF -->
            <!--TMPL_IF NAME="totalToAnonymize"-->
                <br />
                Êtes vous sur de vouloir rendre l'historique de prêt anonyme pour <!-- TMPL_VAR NAME="totalToAnonymize"--> adhérents ?
                <input type="hidden" name="do_anonym" value="<!-- TMPL_VAR NAME="totalToAnonymize" -->" />
            <!-- /TMPL_IF -->
            <br /><br />
            <a href="JavaScript:back();" title="reculer">Annuler</a>
            <input type="submit" value=" OK " style="float:right;"/>
            
            <input type="hidden" name="step3" value="1" />
            <input type="hidden" name="filterdate1" value="<!-- TMPL_VAR NAME="filterdate1" -->" />
            <input type="hidden" name="filterdate2" value="<!-- TMPL_VAR NAME="filterdate2" -->" />
        </form>
    </fieldset>
</div>
<!-- STEP 2 END -->
<!-- /TMPL_IF -->

<!-- TMPL_IF NAME="step3" -->
<!-- Step 3 START -->

    <div id="step3">
          <b>
          <!-- TMPL_IF NAME="do_delete" -->
                <!-- TMPL_IF NAME="trash" -->
                     <!-- TMPL_VAR NAME="TotalDel" --> adhérents ont été effacés avec succès.
                <!-- TMPL_ELSE -->
                     <!-- TMPL_VAR NAME="TotalDel" --> adhérents ont été effacés avec succès.
                <!-- /TMPL_IF -->
            <!-- /TMPL_IF -->
            <!-- TMPL_IF NAME="do_anonym" -->
                Tous les adhérents ayant un historique de prêt antérieur à <!-- TMPL_VAR NAME="filterdate1" --> ont été rendus anonymes.
            <!-- /TMPL_IF -->
          </b>
    </div>
    <a href="/cgi-bin/koha/tools/tools-home.pl">Retourner à l'accueil des outils.</a>
<!-- Step 3 END -->
<!-- /TMPL_IF -->

<script type="text/javascript" language="JavaScript">
// <![CDATA[
        /**
         *  checkForm(form)
         *  This function check the form is correctly filled.
         */
          function checkForm(form) {
              if((form.checkbox[0].checked)){
                  if(!(form.date1.value)){
                    alert("please enter a date !");
                    document.form.date1.focus();
                    return false;
                  }
              }
              if((form.checkbox[1].checked)){
                  if(!(form.date2.value)){
                      alert("please enter a date !");
                      document.form.date2.focus();
                      return false;
                  }
              }
              return true;
          }
          
        /**
         *  checkForm2(form)
         *  This function check the form2 is correctly filled.
         */
          function checkForm2(form) {
              return true;
          }
     // ]]>
</script>
<!-- TMPL_INCLUDE NAME="intranet-bottom.inc" -->
