<!-- TMPL_INCLUDE NAME="doc-head-open.inc" -->
<title>Koha &rsaquo; Périodiques</title>
<!-- TMPL_INCLUDE NAME="doc-head-close.inc" -->

<!-- TMPL_INCLUDE NAME="menus.inc" -->
<!--TMPL_INCLUDE NAME="menu-serials.inc" -->

<!-- Additions to enable Calendar system -->
<link rel="stylesheet" type="text/css" href="<!-- TMPL_VAR name="themelang" -->/includes/calendar/calendar-system.css">
<!-- End of additions -->

<!-- Additions to enable Calendar system -->
<script type="text/javascript" src="<!-- TMPL_VAR name="themelang" -->/includes/calendar/calendar.js"></script>
<script type="text/javascript" src="<!-- TMPL_VAR name="themelang" -->/includes/calendar/calendar-en.js"></script>
<script type="text/javascript" src="<!-- TMPL_VAR name="themelang" -->/includes/calendar/calendar-setup.js"></script>
<!-- End of additions -->

<script type="text/javascript" language="javascript">
<!--
    function _(s) { return s } // dummy function for gettext

// the english words used in display purposes
var text = new Array(_('Numéro'),_('Volume'),_('Prêt'),_('Mois'),_('Semaine'),_('Commence par : '),_('Retour à : '),_('Choisir hémisphère : '),_('Nord'),_('Sud'),
_('Automne'),_('Hiver'),_('Printemps'),_('Été'),_('Automne'),_('Saison'),_('Année'));
var is_season = 0;
var is_hemisphere = 1;

// common pre defined number patterns
function num_pattern() {
var patternchoice = document.getElementById("numberpattern").value;
    switch(patternchoice){
    case "2":
        document.f.add1.value=1;
        document.f.add2.value=1;
        document.f.add3.value=1;
        document.f.every1.value=12;
        document.f.every2.value=1;
        document.f.every3.value=1;
        document.f.whenmorethan1.value=9999999;
        document.f.whenmorethan2.value=12;
        document.f.whenmorethan3.value=4;
        document.f.setto1.value=0;
        document.f.setto2.value=1;
        document.f.setto3.value=1;
        document.f.lastvalue1.value=1;
        document.f.lastvalue2.value=1;
        document.f.lastvalue3.value=1;
        document.f.numberingmethod.value=_('Vol {X}, N° {Y}, Fascicule {Z}');
        moreoptions(text[1],text[0],text[2]);
        display_table(0); // toggle info box on (1) or off (0)
        break;
    case "3":
        document.f.add1.value=1;
        document.f.add2.value=1;
        document.f.add3.value='';
        document.f.every1.value=12;
        document.f.every2.value=1;
        document.f.every3.value='';
        document.f.whenmorethan1.value=9999999;
        document.f.whenmorethan2.value=12;
        document.f.whenmorethan3.value='';
        document.f.setto1.value=0;
        document.f.setto2.value=1;
        document.f.setto3.value='';
        document.f.lastvalue1.value=1;
        document.f.lastvalue2.value=1;
        document.f.lastvalue3.value='';
        document.f.numberingmethod.value=_('Vol {X}, N° {Y}');
        moreoptions(text[1],text[0]);
        display_table(0);
        break;
    case "4":
        document.f.add1.value=1;
        document.f.add2.value=1;
        document.f.add3.value='';
        document.f.every1.value=12;
        document.f.every2.value=1;
        document.f.every3.value='';
        document.f.whenmorethan1.value=9999999;
        document.f.whenmorethan2.value=12;
        document.f.whenmorethan3.value='';
        document.f.setto1.value=0;
        document.f.setto2.value=1;
        document.f.setto3.value='';
        document.f.lastvalue1.value=1;
        document.f.lastvalue2.value=1;
        document.f.lastvalue3.value='';
        document.f.numberingmethod.value=_('Volume {X}, Fascicule {Y}');
        moreoptions(text[1],text[2]);
        display_table(0);
        break;
    case "5":
        document.f.add1.value=1;
        document.f.add2.value=1;
        document.f.add3.value='';
        document.f.every1.value=12;
        document.f.every2.value=1;
        document.f.every3.value='';
        document.f.whenmorethan1.value=9999999;
        document.f.whenmorethan2.value=12;
        document.f.whenmorethan3.value='';
        document.f.setto1.value=0;
        document.f.setto2.value=1;
        document.f.setto3.value='';
        document.f.lastvalue1.value=1;
        document.f.lastvalue2.value=1;
        document.f.lastvalue3.value='';
        document.f.numberingmethod.value=_('N° {X}, Fascicule {Y}');
        moreoptions(text[0],text[2]);
        display_table(0);
        break;
    case "6":
        var d = new Date();
        var sYear = d.getFullYear();
        document.f.add1.value=1;
        document.f.add2.value='1';
        document.f.add3.value='';
        document.f.every1.value=4;
        document.f.every2.value='1';
        document.f.every3.value='';
        document.f.whenmorethan1.value=9999999;
        document.f.whenmorethan2.value='4';
        document.f.whenmorethan3.value='';
        document.f.setto1.value=0;
        document.f.setto2.value='1';
        document.f.setto3.value='';
        document.f.lastvalue1.value=sYear;
        document.f.lastvalue2.value='1';
        document.f.lastvalue3.value='';
        document.f.periodicity.value='8';
        document.f.numberingmethod.value=_('{Y} {X}');
        moreoptions_seasons(text[15],sYear);
        display_table(0);
        is_season = 1;
        break;
    case "7":
        display_table(1);
        document.getElementById("more_options").innerHTML = '';
        document.f.irreg_check.value=1; 
        break;
    default:
        document.f.add1.value=1;
        document.f.add2.value='';
        document.f.add3.value='';
        document.f.every1.value=1;
        document.f.every2.value='';
        document.f.every3.value='';
        document.f.whenmorethan1.value=9999999;
        document.f.whenmorethan2.value='';
        document.f.whenmorethan3.value='';
        document.f.setto1.value=0;
        document.f.setto2.value='';
        document.f.setto3.value='';
        document.f.lastvalue1.value=1;
        document.f.lastvalue2.value='';
        document.f.lastvalue3.value='';
        document.f.numberingmethod.value='{X}';
        moreoptions_daily_check(text[0]);
        document.f.irreg_check.value=1;
        display_table(0);
        break;
    }
}

function display_table(n) {
    if(n==1){
        document.getElementById("basetable").style.display = 'block';
    } else {
        document.getElementById("basetable").style.display = 'none';
    }
}

function modify_num_pattern() {
    document.getElementById("numberpattern").value = '<!-- TMPL_VAR NAME="numberpattern" -->';
    num_pattern();
    
    document.f.add1.value='<!-- TMPL_VAR NAME="add1" -->';
    document.f.add2.value='<!-- TMPL_VAR NAME="add2" -->';
    document.f.add3.value='<!-- TMPL_VAR NAME="add3" -->';
    document.f.every1.value='<!-- TMPL_VAR NAME="every1" -->';
    document.f.every2.value='<!-- TMPL_VAR NAME="every2" -->';
    document.f.every3.value='<!-- TMPL_VAR NAME="every3" -->';
    document.f.whenmorethan1.value='<!-- TMPL_VAR NAME="whenmorethan1" -->';
    document.f.whenmorethan2.value='<!-- TMPL_VAR NAME="whenmorethan2" -->';
    document.f.whenmorethan3.value='<!-- TMPL_VAR NAME="whenmorethan3" -->';
    document.f.setto1.value='<!-- TMPL_VAR NAME="setto1" -->';
    document.f.setto2.value='<!-- TMPL_VAR NAME="setto2" -->';
    document.f.setto3.value='<!-- TMPL_VAR NAME="setto3" -->';
    document.f.lastvalue1.value='<!-- TMPL_VAR NAME="lastvalue1" -->';
    document.f.lastvalue2.value='<!-- TMPL_VAR NAME="lastvalue2" -->';
    document.f.lastvalue3.value='<!-- TMPL_VAR NAME="lastvalue3" -->';
    document.f.numberingmethod.value='<!-- TMPL_VAR NAME="numberingmethod" -->';

    var more_strY;
    var more_strZ;
    <!-- TMPL_IF NAME="add2" -->
    if(<!-- TMPL_VAR NAME="add2" --> > 0){
        more_strY="Y";
    }
    <!-- /TMPL_IF -->
    <!-- TMPL_IF NAME="add3" -->
    if(<!-- TMPL_VAR NAME="add3" --> > 0){
        more_strZ="Z";
    }
    <!-- /TMPL_IF -->

    document.f.lastvaluetemp1.value='<!-- TMPL_VAR NAME="lastvalue1" -->';
    if(more_strY){
        document.f.lastvaluetemp2.value='<!-- TMPL_VAR NAME="lastvalue2" -->';
    document.f.whenmorethantemp2.value='<!-- TMPL_VAR NAME="whenmorethan2" -->';
    }
    if(more_strZ){
        document.f.lastvaluetemp3.value='<!-- TMPL_VAR NAME="lastvalue3" -->';
    document.f.whenmorethantemp3.value='<!-- TMPL_VAR NAME="whenmorethan3" -->';
    }
}

// a pre check with more options to see if 'number' and '1/day' are chosen
function moreoptions_daily_check(x) {
    var periodicity = document.f.periodicity.value;
    var errortext='';
    if(periodicity == 1){
        document.getElementById("irregularity").innerHTML = '';
        var daynames = new Array(_('Lundi'),_('Mardi'),_('Mercredi'),_('Jeudi'),_('Vendredi'),_('Samedi'),_('Dimanche'));
        errortext =_("Indiquer, SVP, quels jours de la semaine vous  <b>N'ATTENDEZ PAS<\\/b> de numéros.<\\/b>");
        for(var j=0;j<daynames.length;j++){
            errortext +="<input type='checkbox' name='irregular' id='irregular"+(j+1)+"' value='"+(j+1)+"' />"+daynames[j]+" &nbsp; ";
        }
        var error = errortext;
        moreoptions(x);
        document.getElementById("irregularity").innerHTML = error;
    } else {
        document.getElementById("irregularity").innerHTML = '';
        document.getElementById("more_options").innerHTML = '';
        moreoptions(x);
    }
}

// to dispaly the more options section
function moreoptions(x,y,z){
document.getElementById("irregularity").innerHTML = '';
document.getElementById("more_options").innerHTML = '';
var textbox = '';
    // alert("X: "+x+"Y: "+y+"Z: "+z);
    if(x){
        textbox +="<table>\n<tr><td>&nbsp;<\/td><td>"+x+"<\/td>";
        if(y){
            textbox +="<td>"+y+"<\/td>";
            if(z){
                textbox +="<td>"+z+"<\/td>";
            }
        }
        textbox +="<\/tr>\n";
        textbox +="<tr><td>"+text[5]+"<\/td><td><input type='text' name='lastvaluetemp1' size='4' onkeyup='moreoptionsupdate(\"lastvalue1\")'><\/td>\n";
        if(y){
            textbox +="<td><input type='text' name='lastvaluetemp2' size='4' onkeyup='moreoptionsupdate(\"lastvalue2\")'><\/td>\n";
            if(z){
                textbox +="<td><input type='text' name='lastvaluetemp3' size='4' onkeyup='moreoptionsupdate(\"lastvalue3\")'><\/td>\n";
            }
        }
        textbox +="<\/tr>\n";
        if(y){
            textbox +="<tr><td>"+text[6]+"<\/td>";
            textbox +="<td><a href='javascript:irregularity_check()'>"+_('Irrégularité ? ')+"<\/a><\/td>\n";
            textbox +="<td><input type='text' name='whenmorethantemp2' size='4' onkeyup='moreoptionsupdate(\"whenmorethan2\",1)'><\/td>\n";
            if(z){
                textbox +="<td><input type='text' name='whenmorethantemp3' size='4' onkeyup='moreoptionsupdate(\"whenmorethan3\",1)'><\/td>\n";
            }
            textbox +="<\/tr>";
        } else {
          textbox +="<tr> <td>"+_('numéros(s) attendu(s)')+"</td><td><input type='text' name='issuesexpectedtemp1' size='4' onkeyup='moreoptionsupdate(\"issuesexpected1\",0)'><br/><a href='javascript:irregularity_check()'>"+_('Irrégularité ? ')+"</a></td></tr>";
        }
        textbox +="<\/table>\n";
    }
    document.getElementById("more_options").innerHTML = textbox;
}

function hemispheres(chosen){
var selbox = document.getElementById("season1");
    if(selbox){
    var selboxselected = selbox.options[selbox.selectedIndex].value;
    selbox.options.length = 0;

    if (chosen == "1") {
        selbox.options[selbox.options.length] = new Option(text[11],'1');
        selbox.options[selbox.options.length] = new Option(text[12],'2');
        selbox.options[selbox.options.length] = new Option(text[13],'3');
        selbox.options[selbox.options.length] = new Option(text[14],'4');
        is_hemisphere = 1;
        selbox.options[selboxselected-1].selected = true;
    }

    if (chosen == "2") {
        selbox.options[selbox.options.length] = new Option(text[13],'1');
        selbox.options[selbox.options.length] = new Option(text[10],'2');
        selbox.options[selbox.options.length] = new Option(text[11],'3');
        selbox.options[selbox.options.length] = new Option(text[12],'4');
        is_hemisphere = 2;
        selbox.options[selboxselected-1].selected = true;
    }
    }
}

// to dispaly the more options section for seasons
function moreoptions_seasons(x,y){
document.getElementById("irregularity").innerHTML = '';
document.getElementById("more_options").innerHTML = '';
var textbox = '';
    // alert("X: "+x+"Year: "+y);
    if(x){
        var hemi_select = parseInt('<!-- TMPL_VAR NAME="hemisphere" -->');
        textbox +="<table>\n<tr><td>"+ text[7]  +"<\/td><td colspan='2'><select name='hemisphere' onchange='hemispheres(this.options[this.selectedIndex].value)'>";
        for(var i = 1; i <= 2; i++){
            textbox +="<option value='"+i+"'";
            if(i == hemi_select){
                textbox += " selected "
            }
            textbox +=">"+text[i+7]+"<\/option>";
        }
        textbox +="<\/select><\/td><\/tr>\n";
        textbox +="<tr><td>&nbsp;<\/td><td>"+x+"<\/td>";
        textbox +="<td>"+text[16]+"<\/td>";
        textbox +="<\/tr>\n";
        textbox +="<tr><td>"+text[5]+"<\/td><td><select name='lastvaluetemp2' id='season1' onchange='moreoptionsupdate(\"lastvalue2\")'>";
        for(var j = 1; j <= 4; j++){
            textbox +="<option value='"+j+"'>"+text[j+10]+"<\/option>";
        }
        textbox +="<\/select><\/td><td><select name='lastvaluetemp1' onchange='moreoptionsupdate(\"lastvalue1\")'>";
        for(var k = parseInt(y); k <= parseInt(y)+15; k++){
            textbox +="<option value='"+k+"'>"+k+"<\/option>";
        }
        textbox +="<\/select><\/td><\/tr>\n";
        textbox +="<tr><td>"+text[6]+"<\/td>";
        textbox +="<td><a href='javascript:irregularity_check()'>"+_('Irrégularité ? ')+"<\/a><\/td>\n";
        textbox +="<td><input type='text' name='whenmorethantemp2' size='4' onkeyup='moreoptionsupdate(\"whenmorethan2\",1)'><\/td>\n";
                textbox +="<\/tr><\/table>\n";
    }
    document.getElementById("more_options").innerHTML = textbox;
}

function irregularity_check(){
    document.f.irreg_check.value = 1; // Irregularity button now pushed
    var periodicity = document.f.periodicity.value;
    var rollover = document.f.issuesexpected1.value;
    if(document.f.whenmorethantemp2){
      rollover = document.f.whenmorethantemp2.value;
    }
    if(document.f.whenmorethantemp3){
        rollover = document.f.whenmorethantemp3.value;
    }
    var error='';
    var toobig;
    var expected; 
    var errortext = _("<b>Attention irrégularité repérée<\\/b><br \\/>");
    switch(periodicity){
    case "1":
        if(rollover < 365) expected =365;
        if(rollover > 365) {
            expectedover=365;
            toobig=1;
        }
        break;
    case "2":
        if(rollover < 52) expected =52;
        if(rollover > 52){
            expectedover=52;
            toobig=1;
        }
        break;
    case "3":
        if(rollover < 26) expected =26;
        if(rollover > 26){
            expectedover=26;
            toobig=1;
        }
        break;
    case "4":
        if(rollover < 17) expected =17;
        if(rollover > 17){
            expectedover=17;
            toobig=1;
        }
        break;
    case "5":
        if(rollover < 12) expected =12;
        if(rollover > 12){
            expectedover=12;
            toobig=1;
        }
        break;
    case "6":
        if(rollover < 6) expected =6;
        if(rollover > 6){
            expectedover=6;
            toobig=1;
        }
        break;
    case "7":
        if(rollover < 4) expected =4;
        if(rollover > 4){
            expectedover=4;
            toobig=1;
        }
        break;
    case "8":
        if(rollover < 4) expected =4;
        if(rollover > 4){
            expectedover=4;
            toobig=1;
        }
        break;
    case "9":
        if(rollover < 2) expected =2;
        if(rollover > 2){
            expectedover=2;
            toobig=1;
        }
        break;
    case "10":
        if(rollover < 1) expected =1;
        if(rollover > 1){
            expectedover=1;
            toobig=1;
        }
        break;
    default:
        break;
    }
    if(expected){
        if(expected == 365){
            var daynames = new Array(_('Lundi'),_('Mardi'),_('Mercredi'),_('Jeudi'),_('Vendredi'),_('Samedi'),_('Dimanche'));
            errortext += _("Indiquer, SVP, quels jours de la semaine vous  <b>N'ATTENDEZ PAS<\\/b> de numéros.<\\/b>");
            for(var j=0;j<daynames.length;j++){
                errortext +="<input type='checkbox' name='irregular' id='irregular"+(j+1)+"' value='"+(j+1)+"' />"+daynames[j]+" &nbsp; ";
            }
            error=errortext;
        } else {
            errortext +=expected+_("uméro(s) attendu(s)")+rollover+_("sont entrés. <br \\/>Merci de signaler à quelle(s) date(s) vous n'attendez pas de numéro <br \\/>");
            var count=0;
            for(var i=rollover;i<expected;i++){
                errortext +="<select name='irregular' id='irregular"+count+"' onchange='display_example(expected)'>\n";
                errortext +=irregular_options(periodicity);
                errortext +="<\/select>\n";
                count++;
            }
            error=errortext;
        }
    }
    if(toobig){
        errortext +=expectedover+_("uméro(s) attendu(s)")+rollover+_("sont entrés.<br \\/>Vous sembler avoir signalé plus de numéros par an que prévu.");
        error=errortext;
    }
    if(error.length ==0){
        error=_('Pas d irrégularités détectées');
    }
    display_example(expected);
    document.getElementById("irregularity").innerHTML = error;
}

function irregular_options(periodicity){
    var titles;
    var count;
<!-- TMPL_IF NAME="weekarrayjs" -->
    var weeks = new Array(<!-- TMPL_VAR NAME="weekarrayjs" -->); 
<!-- /TMPL_IF -->
    var months = new Array(_('Janvier'),_('Février'),_('Mars'),_('Avril'),_('Mai'),_('Juin'),_('Juil'),_('Août'),_('Septembre'),_('Octobre'),_('Novembre'),_('Décembre'));
    var seasons = new Array(_('Automne'),_('Hiver'),_('Printemps'),_('Été'),_('Automne'));
    var errortext='';
    if(periodicity == 1) {
        expected = 366;
        titles = "Day";
        count = 1;
    }
    if(periodicity == 2 || periodicity == 3 || periodicity == 4) { 
        expected = 52;
    <!-- TMPL_IF NAME="weekarrayjs" -->
        titles = weeks;
        count = <!-- TMPL_VAR NAME="weekno" -->;
    <!-- TMPL_ELSE -->
        titles = "Week";
        count = 1;
    <!-- /TMPL_IF -->
    }
    if(periodicity == 5 || periodicity == 6 || periodicity == 7 || periodicity == 8 || periodicity == 9) {
        if(periodicity == 8) {
            is_season = 1; // setting up from edit page
        } 
        if(is_season){
            titles = seasons;
            expected = 4;
            if(is_hemisphere == 2){
                count = 2;
            } else {
                count = 1;
            }
        } else {
            titles = months;
            expected = 12;
            count = 1;
        }
    }
    for(var j=1;j<=expected;j++){
        if(isArray(titles)){
            if(count>expected){
                count = count-expected;
            }
            if(is_season && is_hemisphere == 1){
                errortext +="<option value='"+((count*3)-2)+"'>"+titles[j]+"<\/option>\n";
// alert("value: "+((count*3)-2)+" title: "+titles[j]);
            } else if(is_season && is_hemisphere == 2){
                errortext +="<option value='"+((count*3)-2)+"'>"+titles[j-1]+"<\/option>\n";
// alert("value: "+((count*3)-2)+" title: "+titles[j-1]);
            } else {
                errortext +="<option value='"+count+"'>"+titles[j-1]+"<\/option>\n";
            }
            count++;
        } else {
            errortext +="<option value='"+j+"'>"+titles+" "+j+"<\/option>\n";
        }
    }
    return errortext;
}

function irregular_order(){
    var irregular = '<!-- TMPL_VAR NAME="irregularity" -->';
    var periodicity = document.f.periodicity.value;
    var irregarray = irregular.split(',');
    if(periodicity ==1){
        for(j=0;j<irregarray.length;j++){
        document.getElementById("irregular"+irregarray[j]).checked = true; 
        }
    } else {
        for(i=0;i<irregarray.length;i++){    
            document.getElementById("irregular"+i).value = irregarray[i];
        }
    }
}

function display_example(expected){
    var startfrom1 = parseInt(document.f.lastvalue1.value);
    var startfrom2 = parseInt(document.f.lastvalue2.value);
    var startfrom3 = parseInt(document.f.lastvalue3.value);
    var every1 = parseInt(document.f.every1.value);
    var every2 = parseInt(document.f.every2.value);
    var every3 = parseInt(document.f.every3.value);
    var numberpattern = document.f.numberingmethod.value;
    var whenmorethan2 = parseInt(document.f.whenmorethan2.value);
    var whenmorethan3 = parseInt(document.f.whenmorethan3.value);
    var setto2 = parseInt(document.f.setto2.value);
    var setto3 = parseInt(document.f.setto3.value);
    var displaytext = _('Sur la base du <br \\/> modèle de numérotation saisi<br \\/> cela ressemblera à ceci <br \\/>\\n');
    if(startfrom3>0){
        var count=startfrom3-1;
        var count2=startfrom2;
        for(var i=0;i<12;i++){
            if(count>=whenmorethan3){
                count=setto3;
                if(count2>=whenmorethan2){
                    startfrom1++;
                    count2=setto2;
                } else {
                    count2++;
                }
            } else {
                count++;
            }
            displaytext += numberpattern.replace(/{Z}/,count)+'\n';
            displaytext = displaytext.replace(/{Y}/,count2)+'<br \/>\n';
            displaytext = displaytext.replace(/{X}/,startfrom1)+'<br \/>\n';

        }
    }
    if(startfrom2>0 && !startfrom3){
        var count=startfrom2-1;
        for(var i=0;i<12;i++){
            if(count>=whenmorethan2){
                startfrom1++;
                count=setto2;
            } else {
                count++;
            }

            if(is_season){
                if(is_hemisphere == 2){
                    if(count == 1) {
                        displaytext += numberpattern.replace(/{Y}/,text[count+12])+'\n';
                    } else {
                        displaytext += numberpattern.replace(/{Y}/,text[count+8])+'\n';
                    }
                } else {
                displaytext += numberpattern.replace(/{Y}/,text[count+10])+'\n';
                }
            } else {
                displaytext += numberpattern.replace(/{Y}/,count)+'\n';
            }
            displaytext = displaytext.replace(/{X}/,startfrom1)+'<br \/>\n';
        }
    }
    if(startfrom1>0 && !startfrom2 && !startfrom3){
        var offset=eval(document.f.issuesexpected1.value);
        if (!offset){
            offset = 12 
        }
        for(var i=startfrom1;i<(startfrom1+offset);i+=every1){
            displaytext += numberpattern.replace(/{X}/,i)+'<br \/>\n';
        }
    }
    displaytext = "<div style='padding: 5px; background-color: #CCCCCC'>"+displaytext+"<\/div>";
    document.getElementById("displayexample").innerHTML = displaytext;
}

function isArray(obj) {
if (obj.constructor.toString().indexOf("Array") == -1)
    return false;
else
    return true;
}

function moreoptionsupdate(fieldnames,rollover){
    fieldname = fieldnames;
    fld = fieldname.length;
    fld = fld-1;
    fieldnametempnumber = fieldname.substr(fld);
    //alert(fieldnametempnumber);
    fieldnametemp = fieldname.slice(0,-1)+"temp"+fieldnametempnumber;
    // alert(fieldnametemp);
    eval("document.f."+fieldname+".value = document.f."+fieldnametemp+".value");
//     alert (fieldname+" : "+eval("document.f."+fieldname+".value") +' '+fieldnametemp+' : ' +eval("document.f."+fieldnametemp+".value"));
    if(rollover){
        eval("document.f.every"+(fieldnametempnumber-1)+".value = document.f."+fieldnametemp+".value");
    }
}


function check_input(e){
    var unicode=e.charCode? e.charCode : e.keyCode
    if (unicode!=8 && unicode !=46 && unicode!=9 && unicode !=13){ // if key isn't backspace or delete
        if (unicode<48||unicode>57) { // if not a number
            alert(_("Doit d'être entré sous forme de chiffres, par ex. 10"));
            return false // disable key press
        }
    }
}

-->
</script>

<!-- TMPL_IF name="mod" -->
    <h1>Modifier un abonnement</h1>
    <form method="post" name="f">
        <input type="hidden" name="op" value="modsubscription">
        <input type="hidden" name="subscriptionid" value="<!-- TMPL_VAR name="subscriptionid" -->">
<!-- TMPL_ELSE -->
    <h1>Ajout d'un abonnement </h1>
    <form method="post" name="f">
        <input type="hidden" name="op" value="addsubscription">
<!-- /TMPL_IF -->
<input type="hidden" name="user" value="<!-- TMPL_VAR name="loggedinusername" -->">
<input type="hidden" name="irreg_check" value="0">
<input type="hidden" name="issuesexpected1" value="0">


<div id="subscription_form">
    <h2>État de collection pour <!--TMPL_VAR name="subscriptionid"--></h2>
    <table>
        <tr>
            <td>Bibliothécaire : </td>
            <td><!-- TMPL_VAR name="loggedinusername" --></td>
        </tr>
        <tr>
            <td><label>Fournisseur : </label></td>
            <td><input type="text" name="aqbooksellerid" value="<!-- TMPL_VAR name="aqbooksellerid" -->" size="8"> (<input type="text" name="aqbooksellername" value="<!-- TMPL_VAR name="aqbooksellername" -->" disabled readonly>) <a href="#" onClick="FindAcqui(f)">Rechercher fournisseur</a></td>
        </tr>
        <tr>
            <td><label>Notice bibliographique</label></td>
            <td>
                <input type="text" name="biblionumber" value="<!-- TMPL_VAR name="biblionumber" -->" size="8"> (<input type="text" name="title" value="<!-- TMPL_VAR name="bibliotitle" -->" disabled readonly>) <a href="#" onClick="Plugin(f)">Rechercher notice biblio</a> <!--TMPL_UNLESS Name="mod"--> |
                <a href="/cgi-bin/koha/cataloguing/addbiblio.pl">Créer une notice</a><!--/TMPL_UNLESS-->
            </td>
        </tr>
        <tr>
            <td><label>Cote</label></td>
            <td><input type="text" name="callnumber" value="<!-- TMPL_VAR name="callnumber" -->" size="20"></td>
        </tr>
        <tr>
            <td>Site</td>
            <td>
                <select name="branchcode">
                    <option value="">Tout site</option>
                    <!-- TMPL_LOOP name="branchloop" -->
                        <option value="<!-- TMPL_VAR name="value" -->" <!-- TMPL_IF name="selected" -->selected<!-- /TMPL_IF -->><!-- TMPL_VAR name="branchname" --></option>
                    <!-- /TMPL_LOOP -->
                </select> (Sélectionnez un site)
            </td>
        </tr>
        <tr>
            <td><label>Notes</label></td>
            <td><textarea name="notes" cols="30" rows="2"><!-- TMPL_VAR name="notes" --></textarea></td>
        </tr>
        <tr>
            <td><label>Notes internes</label></td>
            <td><textarea name="internalnotes" cols="30" rows="2"><!-- TMPL_VAR name="internalnotes" --></textarea></td>
        </tr>
        <tr>
            <td>Alerte adhérent  </td>
            <td>
                <select name="letter">
                    <option value="">pas activé</option>
                <!-- TMPL_LOOP name="letterloop" -->
                    <option value="<!-- TMPL_VAR name="value" -->" <!-- TMPL_IF name="selected" -->selected<!-- /TMPL_IF -->><!-- TMPL_VAR name="lettername" --></option>
                <!-- /TMPL_LOOP -->
                </select> (choisir un type de message afin que les adhérents inscrits soient prévenus  de chaque nouvelle parution par email)
            </td>
        </tr>
        <tr>
            <td><b>Attention : </b></td>
            <td>
                <ul>
                    <li>N'oubliez pas que vous <b>devez</b> avoir créé une notice biblio<b>avant</b> de créer un abonnement</li>
                    <li> Vous devez sélectionner un fournisseur si vous souhaitez réclamer les périodiques en retard</li>
                </ul>
            </td>
        </tr>
    </table>
<div>
<div id="subscription_form_planning">
    <h2>Calendrier</h2>
    <table>
        <tr>
            <td>Date d'arrivée prévue  du 1er n° :</td>
            <td>
                <img src="<!-- TMPL_VAR Name="themelang" -->/includes/calendar/cal.gif" id="button2" style="cursor: pointer;"  />
                <input type="text" name="firstacquidate" value="<!-- TMPL_VAR name="startdate" -->" size=13 maxlength=10 id="acqui_date" style="border-width: 0px;" />
                <!-- both scripts for calendar must follow the input field --> 
                <script type="text/javascript">
                    Calendar.setup({
                        inputField:"acqui_date",
                        ifFormat       :   "%d/%m/%Y",
                        button         :   "button2",
                        align          :   "Tl"
                    });
                </script>
                <script type="text/javascript">
                    Calendar.setup({
                        inputField     :   "acqui_date",
                        ifFormat       :   "%d/%m/%Y",
                        button         :   "acqui_date",
                        align          :   "Tl"
                    });
                </script>
            </td>
            <td rowspan="5">
                <div id="displayexample"></div>
            </td>
        </tr>
        <tr>
            <td>Périodicité (*) : </td>
            <td>
                <select name="periodicity" size="1" onchange="javascript:document.getElementsByName('manualhist')[0].checked=(this.value==1);num_pattern;">
                <option value="" selected>-- Choisir --</option>
                <option value="">Inconnu</option>

                <!-- TMPL_IF name="periodicity1" -->
                    <option value="1" selected>Quotidien</option>
                <!-- TMPL_ELSE -->
                    <option value="1">Quotidien</option>
                <!-- /TMPL_IF -->
                <!-- TMPL_IF name="periodicity2" -->
                    <option value="2" selected>Hebdomadaire</option>
                <!-- TMPL_ELSE -->
                    <option value="2">Hebdomadaire</option>
                <!-- /TMPL_IF -->
                <!-- TMPL_IF name="periodicity3" -->
                    <option value="3" selected> Bimensuel</option>
                <!-- TMPL_ELSE -->
                    <option value="3">Bimensuel (2/mois)</option>
                <!-- /TMPL_IF -->
                <!-- TMPL_IF name="periodicity4" -->
                    <option value="4" selected>1/3 semaines</option>
                <!-- TMPL_ELSE -->
                    <option value="4">1/3 semaines</option>
                <!-- /TMPL_IF -->
                <!-- TMPL_IF name="periodicity5" -->
                    <option value="5" selected>Mensuel (1/mois)</option>
                <!-- TMPL_ELSE -->
                    <option value="5">Mensuel (1/mois)</option>
                <!-- /TMPL_IF -->
                <!-- TMPL_IF name="periodicity6" -->
                    <option value="6" selected>Bimestriel (6/an)</option>
                <!-- TMPL_ELSE -->
                    <option value="6">Bimestriel (6/an)</option>
                <!-- /TMPL_IF -->
                <!-- TMPL_IF name="periodicity7" -->
                    <option value="7" selected>Trimestriel (4/an)</option>
                <!-- TMPL_ELSE -->
                    <option value="7">Trimestriel (4/an)</option>
                <!-- /TMPL_IF -->
                <!-- periodicity8 is 1/quarter, exactly like periodicity7 but will use it for seasonal option -->
                <!-- TMPL_IF name="periodicity8" -->
                    <option value="8" selected>Trimestriel (1/trimestre)</option>
                <!-- TMPL_ELSE -->
                    <option value="8">Trimestriel (1/trimestre)</option>
                <!-- /TMPL_IF -->

                <!-- TMPL_IF name="periodicity9" -->
                    <option value="9" selected>Semestriel (2/an)</option>
                <!-- TMPL_ELSE -->
                    <option value="9">Semestriel </option>
                <!-- /TMPL_IF -->
                <!-- TMPL_IF name="periodicity10" -->
                    <option value="10" selected>Annuel</option>
                <!-- TMPL_ELSE -->
                    <option value="10">Annuel</option>
                <!-- /TMPL_IF -->
                <!-- TMPL_IF name="periodicity11" -->
                    <option value="11" selected>Bisannuel</option>
                <!-- TMPL_ELSE -->
                    <option value="11">Bisannuel</option>
                <!-- /TMPL_IF -->
                </select>
                Historique manuel : <input type="checkbox" name="manualhist" value="1" />
            </td>
        </tr>
        <tr>
            <td>Modèle de numérotation :</td>
            <td>
                <select name="numbering_pattern" size="1" id="numberpattern" onchange="num_pattern()">
                    <option value="" selected>-- Choisir --</option>
                    <!-- TMPL_IF name="numberpattern1" -->
                        <option value="1" selected>Numéro</option>
                    <!-- TMPL_ELSE -->
                        <option value="1">Numéro</option>
                    <!-- /TMPL_IF -->
                    <!-- TMPL_IF name="numberpattern2" -->
                        <option value="2" selected>Volume, Numéro, Fascicule</option>
                    <!-- TMPL_ELSE -->
                        <option value="2">Volume, Numéro, Fascicule</option>
                    <!-- /TMPL_IF -->
                    <!-- TMPL_IF name="numberpattern3" -->
                        <option value="3" selected>Volume, Numéro</option>
                    <!-- TMPL_ELSE -->
                        <option value="3">Volume, Numéro</option>
                    <!-- /TMPL_IF -->
                    <!-- TMPL_IF name="numberpattern4" -->
                        <option value="4" selected>Volume, Fascicule</option>
                    <!-- TMPL_ELSE -->
                        <option value="4">Volume, Fascicule</option>
                    <!-- /TMPL_IF -->
                    <!-- TMPL_IF name="numberpattern5" -->
                        <option value="5" selected>Numéro, Fascicule</option>
                    <!-- TMPL_ELSE -->
                        <option value="5">Numéro, Fascicule</option>
                    <!-- /TMPL_IF -->
                    <!-- TMPL_IF name="numberpattern6" -->
                        <option value="6" selected>Seulement saisonnier</option>
                    <!-- TMPL_ELSE -->
                        <option value="6">Seulement saisonnier</option>
                    <!-- /TMPL_IF -->
                    <!-- TMPL_IF name="numberpattern7" -->
                        <option value="7" selected>Aucun de ci-dessus</option>
                    <!-- TMPL_ELSE -->
                        <option value="7">Aucun de ci-dessus</option>
                    <!-- /TMPL_IF -->
                </select>
                <div id="more_options"></div>
                <div id="irregularity"></div>
            </td>
        </tr>
        <tr>
            <td>Commence le : (*)</td>
            <td>
                <img src="<!-- TMPL_VAR Name="themelang" -->/includes/calendar/cal.gif" id="button1" style="cursor: pointer;"  />
                <input type="text" name="startdate" value="<!-- TMPL_VAR name="startdate" -->" size=13 maxlength=10 id="beginning_date" style="border-width: 0px;">
                <!-- both scripts for calendar must follow the input field --> 
                <script type="text/javascript">
                    Calendar.setup({
                        inputField   : "beginning_date",
                        ifFormat     : "%d/%m/%Y",
                        button       : "button1",
                        align        : "Tl"
                    });
                </script>
                <script type="text/javascript">
                    Calendar.setup({
                        inputField   : "beginning_date",
                        ifFormat     : "%d/%m/%Y",
                        button       : "beginning_date",
                        align        : "Tl"
                    });
                </script>
            </td>
        </tr>
        <tr>
            <td>Durée d'abonnement</td>
            <td>
                <select name="subtype">
                    <!-- TMPL_LOOP NAME="subtype" -->
                        <!-- TMPL_IF NAME="selected" -->
                        <option value="<!-- TMPL_VAR NAME="name" -->"  selected="SELECTED">
                        <!-- TMPL_ELSE -->
                        <option value="<!-- TMPL_VAR NAME="name" -->">
                        <!-- /TMPL_IF -->
                        <!-- TMPL_VAR NAME="name" -->
                        </option>
                    <!-- /TMPL_LOOP -->
                </select>
                <input type="text" name="sublength" value="<!-- TMPL_VAR name="sublength" -->" size="3" onkeypress="return check_input(event)"> (*) (Entrer la quantité en nombre)
            </td>
        </tr>
    <tr>
        <td>Calcul de la numérotation</td>
        <td>Formule de numérotation : <input type="text" name="numberingmethod" value="<!-- TMPL_VAR name="numberingmethod" -->"></td>
    </tr>
    <tr>
    <td colspan=3>
        <div id="basetable" style="display: none;">
            <table class="small">
                <tr>
                    <th>&nbsp;</th>
                    <th>X</th>
                    <th>Y</th>
                    <th>Z</th>
                </tr>
                <tr>
                    <td>Ajouter</td>
                    <td>
                        <input type="text" name="add1" value="<!-- TMPL_VAR name="add1" -->">
                    </td>
                    <td>
                        <input type="text" name="add2" value="<!-- TMPL_VAR name="add2" -->">
                    </td>
                    <td>
                        <input type="text" name="add3" value="<!-- TMPL_VAR name="add3" -->">
                    </td>
                </tr>
                <tr>
                    <td>Toutes les</td>
                    <td><input type="text" name="every1" value="<!-- TMPL_VAR name="every1" -->"></td>
                    <td><input type="text" name="every2" value="<!-- TMPL_VAR name="every2" -->"></td>
                    <td><input type="text" name="every3" value="<!-- TMPL_VAR name="every3" -->"></td>
                </tr>
                <tr>
                    <td>Quand supérieur à</td>
                    <td><input type="text" name="whenmorethan1" value="<!-- TMPL_VAR name="whenmorethan1" -->"></td>
                    <td><input type="text" name="whenmorethan2" value="<!-- TMPL_VAR name="whenmorethan2" -->"></td>
                    <td><input type="text" name="whenmorethan3" value="<!-- TMPL_VAR name="whenmorethan3" -->"></td>
                </tr>
                <!-- TMPL_IF name="mod" -->
                <tr>
                    <td>La boucle est</td>
                    <td><input type="text" name="innerloop1" value="<!-- TMPL_VAR name="innerloop1" -->"></td>
                    <td><input type="text" name="innerloop2" value="<!-- TMPL_VAR name="innerloop2" -->"></td>
                    <td><input type="text" name="innerloop3" value="<!-- TMPL_VAR name="innerloop3" -->"></td>
                </tr>
                <!-- /TMPL_IF -->
                <tr>
                    <td>Retourner à</td>
                    <td><input type="text" name="setto1" value="<!-- TMPL_VAR name="setto1" -->"></td>
                    <td><input type="text" name="setto2" value="<!-- TMPL_VAR name="setto2" -->"></td>
                    <td><input type="text" name="setto3" value="<!-- TMPL_VAR name="setto3" -->"></td>
                </tr>
                <tr>
                    <td>
                        <!-- TMPL_IF name="mod" -->
                            Dernière valeur
                        <!-- TMPL_ELSE -->
                            Commence au
                        <!-- /TMPL_IF -->
                    </td>
                    <td><input type="text" name="lastvalue1" value="<!-- TMPL_VAR name="lastvalue1" -->"></td>
                    <td><input type="text" name="lastvalue2" value="<!-- TMPL_VAR name="lastvalue2" -->"></td>
                    <td><input type="text" name="lastvalue3" value="<!-- TMPL_VAR name="lastvalue3" -->"></td>
                </tr>
            </table>
        </div>
        </td></tr>
    </table>
</div>
<!--TMPL_IF Name="history"-->
<div id="subscription_form_history">
    <h2>Historique</h2>
    <table>
        <tr>
          <td>Date de début : </td>
          <td><input type="text" name="histstartdate" value="<!-- TMPL_VAR name="histstartdate" -->"> (Date du premier abonnement)</td>
        </tr>
        <tr>
          <td>Date de fin : </td>
          <td><input type="text" name="enddate" value="<!-- TMPL_VAR name="enddate" -->"> (si vide : l'abonnement est en cours)</td>
        </tr>
        <tr>
            <td>Numéros reçus : </td>
            <td><textarea name="recievedlist" cols="60" rows="5"><!-- TMPL_VAR name="recievedlist" --></textarea></td>
        </tr>
        <tr>
            <td>Numéros manquants : </td>
            <td><textarea name="missinglist" cols="60" rows="5"><!-- TMPL_VAR name="missinglist" --></textarea></td>
        </tr>
        <tr>
            <td>Note à l'OPAC</td>
            <td><textarea name="opacnote" cols="60" rows="5"><!-- TMPL_VAR name="opacnote" --></textarea></td>
        </tr>
        <tr>
            <td>Note interne : </td>
            <td><textarea name="librariannote" cols="60" rows="5"><!-- TMPL_VAR name="librariannote" --></textarea></td>
        </tr>
    </table>
</div>
<!--/TMPL_IF-->
<!-- TMPL_IF name="mod" -->
    <input type="button" value="Enregistrer abonnement" onclick="Check(this.form)" accesskey="w">
<!-- TMPL_ELSE -->
    <input type="button" value="Ajouter un abonnement" onclick="Check(this.form)" accesskey="w">
<!-- /TMPL_IF -->
</form>
</div>


<!-- TMPL_INCLUDE NAME="intranet-bottom.inc" -->

<script language="JavaScript" type="text/javascript">

function Plugin(f)
{
	 window.open('subscription-bib-search.pl','FindABibIndex','width=800,height=400,toolbar=no,scrollbars=yes');
}

function FindAcqui(f)
{
	 window.open('acqui-search.pl','FindASupplier','width=800,height=400,toolbar=no,scrollbars=yes');
}

function Find_ISSN(f)
{
	 window.open('issn-search.pl','FindABibIndex','width=800,height=400,toolbar=no,scrollbars=yes');
}


function Check(f) {
    if (f.startdate.value.length != 0 && f.sublength.value > 0) {
        if (f.irreg_check.value == 1) {
            document.f.submit();
        } else {
            if(f.numbering_pattern.value == ''){
                alert(_("Vous devez choisir une formule de numérotation"));
            } else {
                alert(_("Vous devez vérifier les irrégularités en cliquant sur 'Irrégularités?'"));
            }
        }
    } else {
        alert(_('Les champs notés avec un * sont obligatoires'));
    }
    return false;
}
</script>
<!-- TMPL_IF name="mod" -->
<script type="text/javascript">
window.onload = modify_num_pattern();
    <!-- TMPL_IF name="hemisphere" -->
    window.onload = hemispheres(<!-- TMPL_VAR NAME="hemisphere" -->);
    <!-- /TMPL_IF -->
</script>
<!-- /TMPL_IF -->
<!-- TMPL_IF name="irregularity" -->
<script type="text/javascript">
window.onload = irregularity_check();
window.onload = irregular_order();
</script>
<!-- /TMPL_IF -->
