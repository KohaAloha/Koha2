<!-- TMPL_INCLUDE NAME="doc-head-open.inc" -->Koha<!-- TMPL_INCLUDE NAME="doc-head-close.inc" -->
<!-- TMPL_INCLUDE NAME="menus.inc" -->
<!-- TMPL_INCLUDE NAME="menu-serials.inc" -->




<!--------------------------MAIN BODY OF PAGE-------------------------->

<h1 class="serial">Subscription for <!-- TMPL_VAR name="bibliotitle" --></h1>
<a href="subscription-detail.pl?subscriptionid=<!-- TMPL_VAR name="subscriptionid" -->" class="button serial" title="detail of the subscription">Subscription</a>
<a href="/cgi-bin/koha/serials/serials-home.pl?biblionumber=<!-- TMPL_VAR name="biblionumber" -->" class="button serial" title="all subscriptions on <!-- TMPL_VAR name="title" -->">Subscriptions</a>
<a href="/cgi-bin/koha/catalogue/MARCdetail.pl?biblionumber=<!-- TMPL_VAR name="biblionumber" -->" class="button serial" title="go to <!-- TMPL_VAR name="title" -->">Back to biblio</a>

<div id="bloc25">
<h2 class="serial">waited or late numbers</h2>
    <form method="post" name="f" id="f" action="serials-receive.pl">
        <input type="hidden" name="op" value="serialchangestatus">
        <input type="hidden" name="serial" value="<!-- TMPL_VAR name="serial" -->">
        <input type="hidden" name="subscriptionid" value="<!-- TMPL_VAR name="subscriptionid" -->">
        <input type="hidden" name="user" value="<!-- TMPL_VAR name="user" -->">
    <table class="small">
    <tr>
        <th class="serial">
            Numbered
        </th>
       <th class="serial">
            Published on
        </th>	
        <th class="serial">
            Planned for
        </th>
        <th class="serial">
            Status
        </th>
        <th class="serial">
            Notes
        </th>
    </tr>
    <!-- TMPL_LOOP name="serialslist" -->
        <tr>
            <td>
                <input type="text" name="serialseq" value="<!-- TMPL_VAR name="serialseq" -->" size=30 maxlength=100>
            </td>
	  <td>
                <input type="text" name="publisheddate" value="<!-- TMPL_VAR name="publisheddate" -->" size=10 maxlength=15>
            </td>
            <td>
                <input type="text" name="planneddate" value="<!-- TMPL_VAR name="planneddate" -->" size=10 maxlength=15>
            </td>
            <td>
                <input type="hidden" id="serialidnumber" name="serialid" value="<!-- TMPL_VAR name="serialid" -->">
                <select name="status" size="1"   <!--TMPL_IF name="serialsadditems" -->onChange="javascript:AddItemRefresh();"<!--/TMPL_IF-->>
                    <!--TMPL_IF name="status1" -->
                        <option value="1" selected>Waited</option>
                    <!-- /TMPL_IF -->
                    <!--TMPL_IF name="status2" -->
                        <option value="2" selected>Arrived</option>
                    <!-- TMPL_ELSE -->
                        <option value="2">Arrived</option>
                    <!-- /TMPL_IF -->
                    <!--TMPL_IF name="status3" -->
                        <option value="3" selected>Late</option>
                    <!-- TMPL_ELSE -->
                        <option value="3">Late</option>
                    <!-- /TMPL_IF -->
                    <!--TMPL_IF name="status4" -->
                        <option value="4" selected>Missing</option>
                    <!-- TMPL_ELSE -->
                        <option value="4">Missing</option>
                    <!-- /TMPL_IF -->
                    <!--TMPL_IF name="status5" -->
                        <option value="5" selected>Not published</option>
                    <!-- TMPL_ELSE -->
                        <option value="5">Not published</option>
                    <!-- /TMPL_IF -->
                    <!--TMPL_IF name="status6" -->
                        <option value="6" selected>Delete</option>
                    <!-- TMPL_ELSE -->
                        <option value="6">Delete</option>
                    <!-- /TMPL_IF -->
                </select>
            </td>
            <td>
                <input type="text" name="notes" value="<!-- TMPL_VAR name="notes" -->" size=20 maxlength=255>
            </td>
<!--TMPL_IF name="serialsadditems" -->
	<td>    <input type="hidden" id="serial<!-- TMPL_VAR name="serialid" -->" name="itemnumber" value="<!-- TMPL_VAR name="itemnumber" -->" />
		<input type="hidden" id="holdingbranch<!-- TMPL_VAR name="serialid" -->" name="holdingbranch" value="" />
	             <a  style="display:none;" href="javascript:AddItem('<!-- TMPL_VAR name="scriptaddserials" -->',<!-- TMPL_VAR name="serialid" -->)" name="addbutton" class="button serial" onblur="javascript:AddItemRefresh();">Add item</a>
	</td>
<!--/TMPL_IF-->     
            <td>
                <a href="javascript:PrintList(<!-- TMPL_VAR name="subscriptionid" -->,'<!-- TMPL_VAR name="serialseq" -->')" class="button serial">print</a>
            </td>
        </tr>
    <!-- /TMPL_LOOP -->
    <!-- TMPL_UNLESS name="hassubscriptionexpired" -->
        <tr>
            <td>
                Manual issue <input type="text" name="serialseq" size=30 maxlength=100>
            </td>
 <td>
                <input type="text" name="publisheddate" size=10 maxlength=15>
            </td>
            <td>
                <input type="text" name="planneddate" size=10 maxlength=15>
            </td>
            <td>
                <input type="hidden" name="serialid" value="0">
                <select name="status" size="1" <!--TMPL_IF name="serialsadditems" -->onChange="javascript:AddItemRefresh();"<!--/TMPL_IF-->>
                        <option value="2">Arrived</option>
                        <option value="3" selected>Late</option>
                        <option value="4">Missing</option>
                </select>
            </td>
      <!--TMPL_IF name="serialsadditems" -->
	<td>    <input type="hidden" id="serial0" name="itemnumber" value="0" />
		<input type="hidden" id="holdingbranch0" name="holdingbranch" value="" />
	             <a  style="display:none;" href="javascript:AddItem('<!-- TMPL_VAR name="scriptaddserials" -->',0)" name="addbutton" class="button serial" onblur="javascript:AddItemRefresh();">Add item</a>
	</td>
<!--/TMPL_IF-->   
	
   </tr>
	
    <!-- /TMPL_UNLESS -->
    </table>
    <input type="submit" value="Save changes" accesskey="w" class="button serial">
    <!-- TMPL_IF name="hassubscriptionexpired" -->
        <p>Subscription has expired. Waited last issue status can't be changed. <a href="#" onClick="popup()" class="button serial">Renew</a> your subscription</p>
    <!-- /TMPL_IF -->
    </form>
</div>

<div id="bloc25">
    <h2 class="serial">Subscription summary</h2>
    <form method="post" name="f" action="serials-receive.pl">
        <input type="hidden" name="op" value="modsubscriptionhistory">
        <input type="hidden" name="serial" value="<!-- TMPL_VAR name="serial" -->">
        <input type="hidden" name="subscriptionid" value="<!-- TMPL_VAR name="subscriptionid" -->">
        <input type="hidden" name="user" value="<!-- TMPL_VAR name="user" -->">
        <p><label>Librarian</label><!-- TMPL_VAR name="user" --></p>
        <p><label class="label100">Beginning date (*)</label><input type="text" name="histstartdate" value="<!-- TMPL_VAR name="histstartdate" -->" READONLY></p>
        <p><label class="label100">End date</label><input type="text" name="enddate" value="<!-- TMPL_VAR name="enddate" -->" READONLY></p>
        <p>received issues</p>
        <p>&nbsp;<textarea name="receivedlist" COLS=60 ROWS=5><!-- TMPL_VAR name="receivedlist" --></textarea></p>
        <p>Missing issues</p>
        <p>&nbsp;<textarea name="missinglist" COLS=60 ROWS=2><!-- TMPL_VAR name="missinglist" --></textarea></p>
        <!--TMPL_IF Name="notissuedlist"-->
        <p>Not issued</p>
        <p>&nbsp;<textarea name="notissuedlist" COLS=60 ROWS=2><!-- TMPL_VAR name="notissuedlist" --></textarea></p>
        <!--/TMPL_IF-->
        <p>Opac's note</p>
        <p>&nbsp;<textarea name="opacnote" COLS=60 ROWS=5><!-- TMPL_VAR name="opacnote" --></textarea></p>
        <input type="submit" value="Save changes" class="button serial">
    </form>
</div>

</table>
<script language="JavaScript" type="text/javascript">

function popup() {
     window.open("subscription-renew.pl?subscriptionid=<!-- TMPL_VAR name="subscriptionid">","subscription_renewal",'width=700,height=400,toolbar=false,scrollbars=yes');
}
function AddItem(itemscript,serial) {
     window.open(itemscript+serial,"AddItem",'width=700,height=400,toolbar=no,scrollbars=yes,status=yes');

}
function PrintList(subscriptionid,serialseq) {

    window.open("printlist.pl?subscriptionid="+subscriptionid+"&serialseq="+serialseq);
}
function AddItemRefresh(){
var subf=document.getElementsByName('status');
var adder=document.getElementsByName('addbutton');
var itemnos=document.getElementsByName('itemnumber');
     for (var s=0; s<subf.length; s++ ){
	if (subf.item(s).value == 2 && itemnos.item(s).value==0){
	adder.item(s).style.display = 'block';
	}else{
	adder.item(s).style.display = 'none';
	}
     }
}

</script>
<!-- TMPL_INCLUDE name="intranet-bottom.inc" -->
