<!-- TMPL_INCLUDE NAME="doc-head-open.inc" -->Koha -- Cataloging: <!-- TMPL_IF NAME="oldbiblionumtagfield" -->Edit MARC Record Number <!-- TMPL_VAR name="bibid" --><!-- TMPL_ELSE -->Add MARC Record<!-- /TMPL_IF --><!-- TMPL_INCLUDE NAME="doc-head-close-addbiblio.inc" -->

	<form method="post" name="f" id="f" action="addbiblio.pl">
<h1><!-- TMPL_IF NAME="oldbiblionumtagfield" -->Edit MARC Record Number <!-- TMPL_VAR name="oldbiblionumber" --><!-- TMPL_ELSE -->Add MARC Record<!-- /TMPL_IF --> With Framework : <!--TMPL_VAR Name="framework" --></h1>

		<input type="hidden" name="op" value="addbiblio" />
		<input type="hidden" name="addfield_field" />
		<input type="hidden" name="frameworkcode" value="<!-- TMPL_VAR NAME="frameworkcode" -->" />
		<input type="hidden" name="oldbiblionumber" value="<!-- TMPL_VAR NAME="oldbiblionumber" -->" />
		<!-- TMPL_IF name="bibid" -->
			<input type="button" value="Save Bibliographic Record and go to Items" onclick="Check(this.form)" accesskey="w" />
		<!-- TMPL_ELSE -->
			<input type="button" value="Add Bibliographic Record and go to Items" onclick="Check(this.form)" accesskey="w" />
		<!-- /TMPL_IF -->
	<input type="button" value="z39.50 Search" onclick="PopupZ3950(); return false;" / >

		<!-- TMPL_IF name="0XX" -->
		<a href="#0XX">0</a>
		<!-- /TMPL_IF -->
		<!-- TMPL_IF name="1XX" -->
		<a href="#1XX">1</a>
		<!-- /TMPL_IF -->
		<!-- TMPL_IF name="2XX" -->
		<a href="#2XX">2</a>
		<!-- /TMPL_IF -->
		<!-- TMPL_IF name="3XX" -->
		<a href="#3XX">3</a>
		<!-- /TMPL_IF -->
		<!-- TMPL_IF name="4XX" -->
		<a href="#4XX">4</a>
		<!-- /TMPL_IF -->
		<!-- TMPL_IF name="5XX" -->
		<a href="#5XX">5</a>
		<!-- /TMPL_IF -->
		<!-- TMPL_IF name="6XX" -->
		<a href="#6XX">6</a>
		<!-- /TMPL_IF -->
		<!-- TMPL_IF name="7XX" -->
		<a href="#7XX">7</a>
		<!-- /TMPL_IF -->
		<!-- TMPL_IF name="8XX" -->
		<a href="#8XX">8</a>
		<!-- /TMPL_IF -->
		<!-- TMPL_IF name="9XX" -->
		<a href="#9XX">9</a>
		<!-- /TMPL_IF -->
	
	<div name="0XX" id="0XX">
		<!-- TMPL_IF name="duplicatebiblionumber" -->
			
				<p>Is this a duplicate of <a href="../MARCdetail.pl?bib=<!-- TMPL_VAR name="duplicatebiblionumber" -->" onclick="openWindow('../MARCdetail.pl?bib=<!-- TMPL_VAR name="duplicatebiblionumber" -->&popup=1', 'Duplicate biblio'; return false;)"><!-- TMPL_VAR name="duplicatetitle" --></a>?</p>
				<p>You must either :</p>
				<ul>
					<li>If it is a duplicate, <a href="additem.pl?bibid=<!-- TMPL_VAR name="duplicatebibid" -->">Edit Items</a> of the existing record.</li>
					<li>If not, click to <input type="hidden" value="0" id="confirm_not_duplicate" name="confirm_not_duplicate" /> <a href="#" onclick="confirmnotdup(); return false;">Confirm it's not a duplicate</a></li>
				</ul>
			</div>
		<!-- /TMPL_IF -->
		<!-- TMPL_LOOP NAME="0XX" -->
			<!-- TMPL_IF name="tag" -->
				<p>
				<!-- TMPL_VAR NAME="tag" -->
				<input type="hidden" name="ind_tag" value="<!-- TMPL_VAR NAME="tag" -->" />
				<input type="text" name="indicator" size="3" maxlength="2" value="<!-- TMPL_VAR NAME="indicator" -->" /> - <!-- TMPL_VAR NAME="tag_lib" -->
				<!-- TMPL_IF name="repeatable" -->
					<a href="javascript:AddField('<!-- TMPL_VAR NAME="tag" -->')">+</a>
				<!-- /TMPL_IF -->
				</p>
			<!-- /TMPL_IF -->
			<!-- TMPL_LOOP NAME="subfield_loop" -->
				<p>
					<label>
						<!-- TMPL_VAR NAME="subfield" -->
						<!-- TMPL_IF name="mandatory" --><!-- /TMPL_IF -->
						<!-- TMPL_VAR NAME="marc_lib" -->
						<!-- TMPL_IF name="mandatory" --> *<!-- /TMPL_IF -->
					</label>
					<!-- TMPL_VAR NAME="marc_value" -->
					<input type="hidden" name="tag" value="<!-- TMPL_VAR NAME="tag" -->" />
					<input type="hidden" name="subfield" value="<!-- TMPL_VAR NAME="subfield" -->" />
					<input type="hidden" name="mandatory" value="<!-- TMPL_VAR NAME="mandatory" -->" />
					<input type="hidden" name="kohafield" value="<!-- TMPL_VAR NAME="kohafield" -->" />
					<input type="hidden" name="tag_mandatory" value="<!-- TMPL_VAR NAME="tag_mandatory" -->" />
				</p>
			<!-- /tmpl_loop -->
		<!-- /tmpl_loop -->
	</div>
	
	<div name="1XX" id="1XX">
		<!-- TMPL_LOOP NAME="1XX" -->
			<!-- TMPL_IF name="tag" -->
				<p>
				<!-- TMPL_VAR NAME="tag" -->
				<input type="hidden" name="ind_tag" value="<!-- TMPL_VAR NAME="tag" -->" />
				<input type="text" name="indicator" size="3" maxlength="2" value="<!-- TMPL_VAR NAME="indicator" -->" /> - <!-- TMPL_VAR NAME="tag_lib" -->
				<!-- TMPL_IF name="repeatable" -->
					<a href="javascript:AddField('<!-- TMPL_VAR NAME="tag" -->')">+</a>
				<!-- /TMPL_IF -->
				</p>
			<!-- /TMPL_IF -->
			<!-- TMPL_LOOP NAME="subfield_loop" -->
				<p>
					<label>
						<!-- TMPL_VAR NAME="subfield" -->
						<!-- TMPL_IF name="mandatory" --><!-- /TMPL_IF -->
						<!-- TMPL_VAR NAME="marc_lib" -->
						<!-- TMPL_IF name="mandatory" --> *<!-- /TMPL_IF -->
					</label>
					<!-- TMPL_VAR NAME="marc_value" -->
					<input type="hidden" name="tag" value="<!-- TMPL_VAR NAME="tag" -->" />
					<input type="hidden" name="subfield" value="<!-- TMPL_VAR NAME="subfield" -->" />
					<input type="hidden" name="mandatory" value="<!-- TMPL_VAR NAME="mandatory" -->" />
					<input type="hidden" name="kohafield" value="<!-- TMPL_VAR NAME="kohafield" -->" />
					<input type="hidden" name="tag_mandatory" value="<!-- TMPL_VAR NAME="tag_mandatory" -->" /> 
				</p>
			<!-- /tmpl_loop -->
		<!-- /tmpl_loop -->
	</div>
	
	<div name="2XX" id="2XX">
		<!-- TMPL_LOOP NAME="2XX" -->
			<!-- TMPL_IF name="tag" -->
				<p>
				<!-- TMPL_VAR NAME="tag" -->
				<input type="hidden" name="ind_tag" value="<!-- TMPL_VAR NAME="tag" -->" />
				<input type="text" name="indicator" size="3" maxlength="2" value="<!-- TMPL_VAR NAME="indicator" -->" /> - <!-- TMPL_VAR NAME="tag_lib" -->
				<!-- TMPL_IF name="repeatable" -->
					<a href="javascript:AddField('<!-- TMPL_VAR NAME="tag" -->')">+</a>
				<!-- /TMPL_IF -->
				</p>
			<!-- /TMPL_IF -->
			<!-- TMPL_LOOP NAME="subfield_loop" -->
				<p>
					<label>
						<!-- TMPL_VAR NAME="subfield" -->
						<!-- TMPL_IF name="mandatory" --><!-- /TMPL_IF -->
						<!-- TMPL_VAR NAME="marc_lib" -->
						<!-- TMPL_IF name="mandatory" --> *<!-- /TMPL_IF -->
					</label>
					<!-- TMPL_VAR NAME="marc_value" -->
					<input type="hidden" name="tag" value="<!-- TMPL_VAR NAME="tag" -->" />
					<input type="hidden" name="subfield" value="<!-- TMPL_VAR NAME="subfield" -->" />
					<input type="hidden" name="mandatory" value="<!-- TMPL_VAR NAME="mandatory" -->" />
					<input type="hidden" name="kohafield" value="<!-- TMPL_VAR NAME="kohafield" -->" />
					<input type="hidden" name="tag_mandatory" value="<!-- TMPL_VAR NAME="tag_mandatory" -->" />
				</p>
			<!-- /tmpl_loop -->
		<!-- /tmpl_loop -->
	</div>
	
	<div name="3XX" id="3XX">
		<!-- TMPL_LOOP NAME="3XX" -->
			<!-- TMPL_IF name="tag" -->
				<p>
				<!-- TMPL_VAR NAME="tag" -->
				<input type="hidden" name="ind_tag" value="<!-- TMPL_VAR NAME="tag" -->" />
				<input type="text" name="indicator" size="3" maxlength="2" value="<!-- TMPL_VAR NAME="indicator" -->" /> - <!-- TMPL_VAR NAME="tag_lib" -->
				<!-- TMPL_IF name="repeatable" -->
					<a href="javascript:AddField('<!-- TMPL_VAR NAME="tag" -->')">+</a>
				<!-- /TMPL_IF -->
				</p>
			<!-- /TMPL_IF -->
			<!-- TMPL_LOOP NAME="subfield_loop" -->
				<p>
					<label>
						<!-- TMPL_VAR NAME="subfield" -->
						<!-- TMPL_IF name="mandatory" --><!-- /TMPL_IF -->
						<!-- TMPL_VAR NAME="marc_lib" -->
						<!-- TMPL_IF name="mandatory" --> *<!-- /TMPL_IF -->
					</label>
					<!-- TMPL_VAR NAME="marc_value" -->
					<input type="hidden" name="tag" value="<!-- TMPL_VAR NAME="tag" -->" />
					<input type="hidden" name="subfield" value="<!-- TMPL_VAR NAME="subfield" -->" />
					<input type="hidden" name="mandatory" value="<!-- TMPL_VAR NAME="mandatory" -->" />
					<input type="hidden" name="kohafield" value="<!-- TMPL_VAR NAME="kohafield" -->" />
					<input type="hidden" name="tag_mandatory" value="<!-- TMPL_VAR NAME="tag_mandatory" -->" />
				</p>
			<!-- /tmpl_loop -->
		<!-- /tmpl_loop -->
	</div>
	
	<div name="4XX" id="4XX">
		<!-- TMPL_LOOP NAME="4XX" -->
			<!-- TMPL_IF name="tag" -->
				<p>
				<!-- TMPL_VAR NAME="tag" -->
				<input type="hidden" name="ind_tag" value="<!-- TMPL_VAR NAME="tag" -->" />
				<input type="text" name="indicator" size="3" maxlength="2" value="<!-- TMPL_VAR NAME="indicator" -->" /> - <!-- TMPL_VAR NAME="tag_lib" -->
				<!-- TMPL_IF name="repeatable" -->
					<a href="javascript:AddField('<!-- TMPL_VAR NAME="tag" -->')">+</a>
				<!-- /TMPL_IF -->
				</p>
			<!-- /TMPL_IF -->
			<!-- TMPL_LOOP NAME="subfield_loop" -->
				<p>
					<label>
						<!-- TMPL_VAR NAME="subfield" -->
						<!-- TMPL_IF name="mandatory" --><!-- /TMPL_IF -->
						<!-- TMPL_VAR NAME="marc_lib" -->
						<!-- TMPL_IF name="mandatory" --> *<!-- /TMPL_IF -->
					</label>
					<!-- TMPL_VAR NAME="marc_value" -->
					<input type="hidden" name="tag" value="<!-- TMPL_VAR NAME="tag" -->" />
					<input type="hidden" name="subfield" value="<!-- TMPL_VAR NAME="subfield" -->" />
					<input type="hidden" name="mandatory" value="<!-- TMPL_VAR NAME="mandatory" -->" />
					<input type="hidden" name="kohafield" value="<!-- TMPL_VAR NAME="kohafield" -->" />
					<input type="hidden" name="tag_mandatory" value="<!-- TMPL_VAR NAME="tag_mandatory" -->" />
				</p>
			<!-- /tmpl_loop -->
		<!-- /tmpl_loop -->
	</div>
	
	<div name="5XX" id="5XX">
		<!-- TMPL_LOOP NAME="5XX" -->
			<!-- TMPL_IF name="tag" -->
				<p>
				<!-- TMPL_VAR NAME="tag" -->
				<input type="hidden" name="ind_tag" value="<!-- TMPL_VAR NAME="tag" -->" />
				<input type="text" name="indicator" size="3" maxlength="2" value="<!-- TMPL_VAR NAME="indicator" -->" /> - <!-- TMPL_VAR NAME="tag_lib" -->
				<!-- TMPL_IF name="repeatable" -->
					<a href="javascript:AddField('<!-- TMPL_VAR NAME="tag" -->')">+</a>
				<!-- /TMPL_IF -->
				</p>
			<!-- /TMPL_IF -->
			<!-- TMPL_LOOP NAME="subfield_loop" -->
				<p>
					<label>
						<!-- TMPL_VAR NAME="subfield" -->
						<!-- TMPL_IF name="mandatory" --><!-- /TMPL_IF -->
						<!-- TMPL_VAR NAME="marc_lib" -->
						<!-- TMPL_IF name="mandatory" --> *<!-- /TMPL_IF -->
					</label>
					<!-- TMPL_VAR NAME="marc_value" -->
					<input type="hidden" name="tag" value="<!-- TMPL_VAR NAME="tag" -->" />
					<input type="hidden" name="subfield" value="<!-- TMPL_VAR NAME="subfield" -->" />
					<input type="hidden" name="mandatory" value="<!-- TMPL_VAR NAME="mandatory" -->" />
					<input type="hidden" name="kohafield" value="<!-- TMPL_VAR NAME="kohafield" -->" />
					<input type="hidden" name="tag_mandatory" value="<!-- TMPL_VAR NAME="tag_mandatory" -->" />
				</p>
			<!-- /tmpl_loop -->
		<!-- /tmpl_loop -->
	</div>
	
	<div name="6XX" id="6XX">
		<!-- TMPL_LOOP NAME="6XX" -->
			<!-- TMPL_IF name="tag" -->
				<p>
				<!-- TMPL_VAR NAME="tag" -->
				<input type="hidden" name="ind_tag" value="<!-- TMPL_VAR NAME="tag" -->" />
				<input type="text" name="indicator" size="3" maxlength="2" value="<!-- TMPL_VAR NAME="indicator" -->" /> - <!-- TMPL_VAR NAME="tag_lib" -->
				<!-- TMPL_IF name="repeatable" -->
					<a href="javascript:AddField('<!-- TMPL_VAR NAME="tag" -->')">+</a>
				<!-- /TMPL_IF -->
				</p>
			<!-- /TMPL_IF -->
			<!-- TMPL_LOOP NAME="subfield_loop" -->
				<p>
					<label>
						<!-- TMPL_VAR NAME="subfield" -->
						<!-- TMPL_IF name="mandatory" --><!-- /TMPL_IF -->
						<!-- TMPL_VAR NAME="marc_lib" -->
						<!-- TMPL_IF name="mandatory" --> *<!-- /TMPL_IF -->
					</label>
					<!-- TMPL_VAR NAME="marc_value" -->
					<input type="hidden" name="tag" value="<!-- TMPL_VAR NAME="tag" -->" />
					<input type="hidden" name="subfield" value="<!-- TMPL_VAR NAME="subfield" -->" />
					<input type="hidden" name="mandatory" value="<!-- TMPL_VAR NAME="mandatory" -->" />
					<input type="hidden" name="kohafield" value="<!-- TMPL_VAR NAME="kohafield" -->" />
					<input type="hidden" name="tag_mandatory" value="<!-- TMPL_VAR NAME="tag_mandatory" -->" />
				</p>
			<!-- /tmpl_loop -->
		<!-- /tmpl_loop -->
	</div>
	
	<div name="7XX" id="7XX">
		<!-- TMPL_LOOP NAME="7XX" -->
			<!-- TMPL_IF name="tag" -->
				<p>
				<!-- TMPL_VAR NAME="tag" -->
				<input type="hidden" name="ind_tag" value="<!-- TMPL_VAR NAME="tag" -->" />
				<input type="text" name="indicator" size="3" maxlength="2" value="<!-- TMPL_VAR NAME="indicator" -->" /> - <!-- TMPL_VAR NAME="tag_lib" -->
				<!-- TMPL_IF name="repeatable" -->
					<a href="javascript:AddField('<!-- TMPL_VAR NAME="tag" -->')">+</a>
				<!-- /TMPL_IF -->
				</p>
			<!-- /TMPL_IF -->
			<!-- TMPL_LOOP NAME="subfield_loop" -->
				<p>
					<label>
						<!-- TMPL_VAR NAME="subfield" -->
						<!-- TMPL_IF name="mandatory" --><!-- /TMPL_IF -->
						<!-- TMPL_VAR NAME="marc_lib" -->
						<!-- TMPL_IF name="mandatory" --> *<!-- /TMPL_IF -->
					</label>
					<!-- TMPL_VAR NAME="marc_value" -->
					<input type="hidden" name="tag" value="<!-- TMPL_VAR NAME="tag" -->" />
					<input type="hidden" name="subfield" value="<!-- TMPL_VAR NAME="subfield" -->" />
					<input type="hidden" name="mandatory" value="<!-- TMPL_VAR NAME="mandatory" -->" />
					<input type="hidden" name="kohafield" value="<!-- TMPL_VAR NAME="kohafield" -->" />
					<input type="hidden" name="tag_mandatory" value="<!-- TMPL_VAR NAME="tag_mandatory" -->" />
				</p>
			<!-- /tmpl_loop -->
		<!-- /tmpl_loop -->
	</div>
	
	<div name="8XX" id="8XX">
		<!-- TMPL_LOOP NAME="8XX" -->
			<!-- TMPL_IF name="tag" -->
				<p>
				<!-- TMPL_VAR NAME="tag" -->
				<input type="hidden" name="ind_tag" value="<!-- TMPL_VAR NAME="tag" -->" />
				<input type="text" name="indicator" size="3" maxlength="2" value="<!-- TMPL_VAR NAME="indicator" -->" /> - <!-- TMPL_VAR NAME="tag_lib" -->
				<!-- TMPL_IF name="repeatable" -->
					<a href="javascript:AddField('<!-- TMPL_VAR NAME="tag" -->')">+</a>
				<!-- /TMPL_IF -->
				</p>
			<!-- /TMPL_IF -->
			<!-- TMPL_LOOP NAME="subfield_loop" -->
				<p>
					<label>
						<!-- TMPL_VAR NAME="subfield" -->
						<!-- TMPL_IF name="mandatory" --><!-- /TMPL_IF -->
						<!-- TMPL_VAR NAME="marc_lib" -->
						<!-- TMPL_IF name="mandatory" --> *<!-- /TMPL_IF -->
					</label>
					<!-- TMPL_VAR NAME="marc_value" -->
					<input type="hidden" name="tag" value="<!-- TMPL_VAR NAME="tag" -->" />
					<input type="hidden" name="subfield" value="<!-- TMPL_VAR NAME="subfield" -->" />
					<input type="hidden" name="mandatory" value="<!-- TMPL_VAR NAME="mandatory" -->" />
					<input type="hidden" name="kohafield" value="<!-- TMPL_VAR NAME="kohafield" -->" />
					<input type="hidden" name="tag_mandatory" value="<!-- TMPL_VAR NAME="tag_mandatory" -->" />
				</p>
			<!-- /tmpl_loop -->
		<!-- /tmpl_loop -->
	</div>
	
	<div name="9XX" id="9XX">
		<!-- TMPL_LOOP NAME="9XX" -->
			<!-- TMPL_IF name="tag" -->
				<p>
				<!-- TMPL_VAR NAME="tag" -->
				<input type="hidden" name="ind_tag" value="<!-- TMPL_VAR NAME="tag" -->" />
				<input type="text" name="indicator" size="3" maxlength="2" value="<!-- TMPL_VAR NAME="indicator" -->" /> - <!-- TMPL_VAR NAME="tag_lib" -->
				<!-- TMPL_IF name="repeatable" -->
					<a href="javascript:AddField('<!-- TMPL_VAR NAME="tag" -->')">+</a>
				<!-- /TMPL_IF -->
				</p>
			<!-- /TMPL_IF -->
			<!-- TMPL_LOOP NAME="subfield_loop" -->
				<p>
					<label>
						<!-- TMPL_VAR NAME="subfield" -->
						<!-- TMPL_IF name="mandatory" --><!-- /TMPL_IF -->
						<!-- TMPL_VAR NAME="marc_lib" -->
						<!-- TMPL_IF name="mandatory" --> *<!-- /TMPL_IF -->
					</label>
					<!-- TMPL_VAR NAME="marc_value" -->
					<input type="hidden" name="tag" value="<!-- TMPL_VAR NAME="tag" -->" />
					<input type="hidden" name="subfield" value="<!-- TMPL_VAR NAME="subfield" -->" />
					<input type="hidden" name="mandatory" value="<!-- TMPL_VAR NAME="mandatory" -->" />
					<input type="hidden" name="kohafield" value="<!-- TMPL_VAR NAME="kohafield" -->" />
					<input type="hidden" name="tag_mandatory" value="<!-- TMPL_VAR NAME="tag_mandatory" -->" />
				</p>
			<!-- /tmpl_loop -->
		<!-- /tmpl_loop -->
	</div>
	
		<div name="hidden" id="hidden">
		<!-- TMPL_LOOP NAME="hidden_loop" -->
				<input type="hidden" name="tag" value="<!-- TMPL_VAR NAME="tag" -->" />
				<input type="hidden" name="subfield" value="<!-- TMPL_VAR NAME="subfield" -->" />
				<input type="hidden" name="mandatory" value="<!-- TMPL_VAR NAME="mandatory" -->" />
				<input type="hidden" name="kohafield" value="<!-- TMPL_VAR NAME="kohafield" -->" />
				<input type="hidden" name="tag_mandatory" value="<!-- TMPL_VAR NAME="tag_mandatory" -->" />
		<!-- /TMPL_LOOP -->	<br clear="both" />
		</div>	<br clear="both" />
		<!-- TMPL_IF name="oldbiblionumtagfield" -->
			<input type="hidden" name="tag" value="<!-- TMPL_VAR NAME="oldbiblionumtagfield" -->" />
			<input type="hidden" name="subfield" value="<!-- TMPL_VAR NAME="oldbiblionumtagsubfield" -->" />
			<input type="hidden" name="field_value" value="<!-- TMPL_VAR NAME="oldbiblionumber" -->" />
			<input type="hidden" name="mandatory" value="0" />
			<input type="hidden" name="kohafield" value="<!-- TMPL_VAR NAME="kohafield" -->" />
			<input type="hidden" name="tag" value="<!-- TMPL_VAR NAME="oldbiblioitemnumtagfield" -->" />
			<input type="hidden" name="subfield" value="<!-- TMPL_VAR NAME="oldbiblioitemnumtagsubfield" -->" />
			<input type="hidden" name="field_value" value="<!-- TMPL_VAR NAME="oldbiblioitemnumber" -->" />
			<input type="hidden" name="mandatory" value="0" />
			<input type="hidden" name="kohafield" value="<!-- TMPL_VAR NAME="kohafield" -->" />
			<input type="hidden" name="tag_mandatory" value="<!-- TMPL_VAR NAME="tag_mandatory" -->" />
		<!-- /TMPL_IF -->
	</form>

	</div>
<script language="JavaScript" type="text/javascript">

function _(s) { return s } // dummy function for gettext
function confirmnotdup(){
	document.getElementById("confirm_not_duplicate").value = 1;
	var checkform =	document.getElementById("f");
	Check(checkform);
}

function Check(f) {
	// Scan for nonempty fields
	var field_is_nonempty_p = new Array();
	for (i=0 ; i<f.field_value.length ; i++) {
	    field_is_nonempty_p[f.tag[i].value] = 0;
	}
	for (i=0 ; i<f.field_value.length ; i++) {
	    if (f.field_value[i].value.length != 0) {
		field_is_nonempty_p[f.tag[i].value] += 1;
	    }
	}

	// Scan for missing mandatory subfields
	var total_missing_mandatory_subfields = 0;
	var missing_mandatory_subfields = new Array();
	for (i=0 ; i<f.field_value.length-2 ; i++) {
		if (f.field_value[i].value.length==0 && f.mandatory[i].value==1) {
		    // We should not flag an error unless the tag is also
		    // mandatory, or if something else in the tag is entered

		    if (f.tag_mandatory[i].value == 1 || field_is_nonempty_p[f.tag[i].value]) {
			document.getElementById("error"+i).style.backgroundColor="#FF0000";
			total_missing_mandatory_subfields++;
			if (document.getElementById("error"+i).parentNode.tagName == "B")
			{
				missing_mandatory_subfields.push(document.getElementById("error"+i).innerHTML + " (tab " +  document.getElementById("error"+i).parentNode.parentNode.parentNode.parentNode.id.substr(0,1) + ")");
			}
			else
			{
				missing_mandatory_subfields.push(document.getElementById("error"+i).innerHTML + " (tab " +  document.getElementById("error"+i).parentNode.parentNode.parentNode.id.substr(0,1) + ")");
			}

			}
		} else {
// 			alert("I = "+i);
			document.getElementById("error"+i).style.backgroundColor="#FFFFCC";
		}
	}

	// Scan for missing mandatory tags
	var total_missing_mandatory_tags = 0;
	var seen_mandatory_tag_p = new Array();
	var missing_mandatory_tags = new Array();
	for (i=0 ; i<f.field_value.length ; i++) {
	    var j = f.tag[i].value;
	    if (!field_is_nonempty_p[j] && f.tag_mandatory[i].value == 1) {
		if (seen_mandatory_tag_p[j] != 1) {
		    seen_mandatory_tag_p[j] = 1;
		    total_missing_mandatory_tags++;
 		    if (document.getElementById("error"+i).parentNode.tagName == "B")
		    {
				missing_mandatory_tags.push(document.getElementById("error"+i).innerHTML + " (tab " +  document.getElementById("error"+i).parentNode.parentNode.parentNode.parentNode.id.substr(0,1) + ")");
		    }
		    else
		    {
				missing_mandatory_tags.push(document.getElementById("error"+i).innerHTML + " (tab " +  document.getElementById("error"+i).parentNode.parentNode.parentNode.id.substr(0,1) + ")");
			}
		}
		document.getElementById("error"+i).style.backgroundColor="#ffff00";
	    }
	}

	var total_errors = total_missing_mandatory_tags + total_missing_mandatory_subfields;
	var alertString2;
	if (total_errors!=0) {
		alertString2  = _("Form not submitted because of the following problem(s)");
		alertString2 += "\n------------------------------------------------------------------------------------\n";
		alertString2 += "\n- "+ total_missing_mandatory_tags +_(" mandatory tags empty");
		for (i=0; i<missing_mandatory_tags.length; i++)
		{
			alertString2 += "\n--->"+ missing_mandatory_tags[i];
		}
  		alertString2 += "\n- "+ total_missing_mandatory_subfields +_(" mandatory fields empty (see bold subfields)");
		for (i=0; i<missing_mandatory_subfields.length; i++)
		{
			alertString2 += "\n--->"+ missing_mandatory_subfields[i];
		}
		alert(alertString2);
	} else {
		document.forms[0].submit();
	}
}
function Dopop(link,i) {
	defaultvalue=document.forms[0].field_value[i].value;
	newin=window.open(link+"&result="+defaultvalue,"value builder",'width=550,height=550,toolbar=false,scrollbars=yes');
}

function PopupZ3950() {
    var strQuery="";
	var error = 0;
	for (i=0 ; i<document.forms[0].field_value.length ; i++) {
		if (document.forms[0].kohafield[i].value == "biblioitems.isbn"){
			if(document.forms[0].field_value[i].value.length>0) {
		    strQuery += "&isbn="+document.forms[0].field_value[i].value;
		} else {
			error++;
		}
		}
		if (document.forms[0].kohafield[i].value == "biblio.title"){
			if(document.forms[0].field_value[i].value.length>0) {
		    strQuery += "&title="+document.forms[0].field_value[i].value;
		} else {
			error++;
		}
		}
		if (document.forms[0].kohafield[i].value == "biblio.author"){
			if(document.forms[0].field_value[i].value.length>0) {
		    strQuery += "&author="+document.forms[0].field_value[i].value;
		} else { 
			error++;
		}
		}
		if (document.forms[0].kohafield[i].value == "biblioitems.issn"){
			if(document.forms[0].field_value[i].value.length>0) {
		    strQuery += "&issn="+document.forms[0].field_value[i].value;
		} else {
			error++;
		}
		}
	}
	if(error < 4){
	newin=window.open("../z3950/search.pl?bibid=<!-- TMPL_VAR NAME="bibid" -->"+strQuery,"z3950search",'width=640,height=400,location=yes,toolbar=no,scrollbars=yes');
	} else {
		alert("To perform a z39.50 search, you must enter at least one of the following: \n\n ISBN\n ISSN\n Title\n Author\n");
	}
}

function Changefwk(FwkList) {
  var fwk = FwkList.options[FwkList.selectedIndex].value;
  window.location = "addbiblio.pl?oldbiblionumber=<!--TMPL_VAR Name="oldbiblionumber"-->&frameworkcode="+fwk;
}

function AddField(field) {
	document.forms[0].op.value = "addfield";
	document.forms[0].addfield_field.value=field;
	document.f.submit();
}
</script></body>
</html>
